# –î–ï–¢–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –ê–Ω–∞–ª–∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º

## I. MAKE_FEATURES.PY - –ê–ù–ê–õ–ò–ó

### ‚úì –°–¢–ê–¢–£–°: –ü–û–õ–ù–û–°–¢–¨–Æ –ö–û–†–†–ï–ö–¢–ï–ù

### 1. –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫–æ–Ω (—Å—Ç—Ä–æ–∫–∏ 24-37)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|----------|---------|-----------|--------|
| `--lookbacks` (—Å—Ç. 24) | 240,720,1200,1440,5040,10080,12000 | SMA/returns –¥–ª—è 4h | ‚úì –ö–û–†–†–ï–ö–¢–ù–û |
| `--yang-zhang-windows` (—Å—Ç. 26) | 2880,10080,43200 | Yang-Zhang 48h, 7d, 30d | ‚úì –ö–û–†–†–ï–ö–¢–ù–û |
| `--parkinson-windows` (—Å—Ç. 35) | 2880,10080 | Parkinson 48h, 7d | ‚úì –ö–û–†–†–ï–ö–¢–ù–û |
| `--taker-buy-ratio-windows` (—Å—Ç. 30) | 480,960,1440 | TBR SMA 8h, 16h, 24h | ‚úì –ö–û–†–†–ï–ö–¢–ù–û |
| `--taker-buy-ratio-momentum` (—Å—Ç. 31) | 240,480,720,1440 | TBR momentum 4h, 8h, 12h, 24h | ‚úì –ö–û–†–†–ï–ö–¢–ù–û |
| `--cvd-windows` (—Å—Ç. 34) | 1440,10080 | CVD 24h, 7d | ‚úì –ö–û–†–†–ï–ö–¢–ù–û |
| `--garch-windows` (—Å—Ç. 36) | 12000,20160,43200 | GARCH 200h, 14d, 30d | ‚úì –ö–û–†–†–ï–ö–¢–ù–û |
| `--bar-duration-minutes` (—Å—Ç. 37) | 240 | 4h –∏–Ω—Ç–µ—Ä–≤–∞–ª | ‚úì –ö–û–†–†–ï–ö–¢–ù–û |

**–í—ã–≤–æ–¥:** –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –ø–æ–¥–æ–±—Ä–∞–Ω—ã –¥–ª—è 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º –∏ –∞–¥–µ–∫–≤–∞—Ç–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

### 2. –ü—É—Ç–∏ –∫ –¥–∞–Ω–Ω—ã–º (—Å—Ç—Ä–æ–∫–∏ 21-22)

- –°—Ç—Ä–æ–∫–∞ 21: `--in` –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è parquet/csv —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ `ts_ms,symbol,price`
- –°—Ç—Ä–æ–∫–∞ 22: `--out` default="data/features.parquet"
- **–í—ã–≤–æ–¥:** –§–∞–π–ª –¢–ê–ô–ú–§–†–ï–ô–ú-–ê–ì–ù–û–°–¢–ò–ß–ï–ù, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –ù–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ `klines_1h` –∏–ª–∏ `klines_4h`. ‚úì –ü–†–ê–í–ò–õ–¨–ù–û

### 3. Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è (—Å—Ç. 52-62)

```python
spec = FeatureSpec(
    lookbacks_prices=lookbacks,           # –ò–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
    rsi_period=int(args.rsi_period),      # –ò–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (default=14)
    yang_zhang_windows=yang_zhang_wins,   # –ò–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
    ...
    bar_duration_minutes=int(args.bar_duration_minutes),  # –ò–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (default=240)
)
```

**–í—ã–≤–æ–¥:** –ù–µ—Ç hardcoded –∑–Ω–∞—á–µ–Ω–∏–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è 1m/1h. –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–æ. ‚úì –û–¢–õ–ò–ß–ù–û

---

## II. MEDIATOR.PY - –ê–ù–ê–õ–ò–ó

### ‚ö†Ô∏è –°–¢–ê–¢–£–°: –ö–†–ò–¢–ò–ß–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –û–ë–ù–ê–†–£–ñ–ï–ù–´

### 1. –ö–†–ò–¢–ò–ß–ù–ê–Ø –û–®–ò–ë–ö–ê #1: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º–µ–Ω SMA –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 960, 963)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –°—Ç—Ä–æ–∫–∞ 960:
ma5 = self._get_safe_float(row, "sma_5", float('nan'))

# –°—Ç—Ä–æ–∫–∞ 963:
ma20 = self._get_safe_float(row, "sma_21", float('nan'))
```

**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç transformers.py:**
```
sma_240, sma_720, sma_1200, sma_1440, sma_5040, sma_10080, sma_12000
```

**–ê–Ω–∞–ª–∏–∑:**
| –û–∂–∏–¥–∞–µ—Ç—Å—è –≤ mediator.py | –°–æ–∑–¥–∞–µ—Ç—Å—è –≤ transformers.py | –°—Ç–∞—Ç—É—Å |
|----------------------|---------------------------|--------|
| sma_5 | –ù–ï –°–û–ó–î–ê–ï–¢–°–Ø | ‚ùå –û–®–ò–ë–ö–ê |
| sma_21 | –ù–ï –°–û–ó–î–ê–ï–¢–°–Ø | ‚ùå –û–®–ò–ë–ö–ê |

**–ö–æ—Ä–µ–Ω—å –æ—à–∏–±–∫–∏:**
- –°—Ç–∞—Ä—ã–π –∫–æ–¥ –±—ã–ª –Ω–∞–ø–∏—Å–∞–Ω –¥–ª—è 1h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞, –≥–¥–µ –æ–∫–Ω–∞ –≤ –ë–ê–†–ê–•: [5, 21, 50]
- –≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–æ 5m, 21h, 50h –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–∞–º –ø—Ä–∏ 1h –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ
- –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ 4h, –æ–∫–Ω–∞ —Å—Ç–∞–ª–∏ –≤ –ú–ò–ù–£–¢–ê–•: [240, 720, 1200, ...] –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏
- mediator.py –ù–ï –±—ã–ª –æ–±–Ω–æ–≤–ª–µ–Ω!

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- `ma5` –∏ `ma20` –≤ –º–µ—Ç–æ–¥–µ `_extract_technical_indicators` –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç `float('nan')`
- –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ NaN –≤ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–º –≤–µ–∫—Ç–æ—Ä–µ
- –ú–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
–°–ª–µ–¥—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–ø—Ä–∏–º–µ—Ä—ã):
```python
# –û–ø—Ü–∏—è 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ SMA –ø—Ä–∏–∑–Ω–∞–∫–∏
ma5 = self._get_safe_float(row, "sma_240", float('nan'))  # 4h = 240 –º–∏–Ω
ma20 = self._get_safe_float(row, "sma_1440", float('nan'))  # 24h = 1440 –º–∏–Ω (–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥)

# –û–ø—Ü–∏—è 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏–µ –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º
ma5 = self._get_safe_float(row, "sma_240", float('nan'))   # –ö–æ—Ä–æ—Ç–∫–∏–π (4h)
ma20 = self._get_safe_float(row, "sma_10080", float('nan'))  # –î–ª–∏–Ω–Ω—ã–π (7 –¥–Ω–µ–π ‚âà –Ω–µ–¥–µ–ª—å–Ω—ã–π)
```

**–°–¢–†–û–ö–ò –û–®–ò–ë–ö–ò:** 960, 963

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ _extract_norm_cols (—Å—Ç—Ä–æ–∫–∏ 1012-1054)

**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–æ–∑–¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –≤ transformers.py

#### 2.1 CVD –ø—Ä–∏–∑–Ω–∞–∫–∏

```python
# –°—Ç—Ä–æ–∫–∞ 1025:
norm_cols[0] = self._get_safe_float(row, "cvd_24h", 0.0)

# –°—Ç—Ä–æ–∫–∞ 1026:
norm_cols[1] = self._get_safe_float(row, "cvd_7d", 0.0)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ transformers.py (—Å—Ç—Ä–æ–∫–∏ 727-743):**
```python
# cvd_windows_minutes = [1440, 10080]
# _format_window_name(1440) ‚Üí "24h" ‚Üí "cvd_24h" ‚úì
# _format_window_name(10080) ‚Üí "7d" ‚Üí "cvd_7d" ‚úì
```
**–°—Ç–∞—Ç—É—Å:** ‚úì –ö–û–†–†–ï–ö–¢–ù–û (2/2)

#### 2.2 Yang-Zhang –ø—Ä–∏–∑–Ω–∞–∫–∏

```python
# –°—Ç—Ä–æ–∫–∞ 1027: norm_cols[2] = self._get_safe_float(row, "yang_zhang_48h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1028: norm_cols[3] = self._get_safe_float(row, "yang_zhang_7d", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1037: norm_cols[10] = self._get_safe_float(row, "yang_zhang_30d", 0.0)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ transformers.py (—Å—Ç—Ä–æ–∫–∏ 624-641):**
```python
# yang_zhang_windows_minutes = [2880, 10080, 43200]
# _format_window_name(2880) ‚Üí "48h" ‚Üí "yang_zhang_48h" ‚úì
# _format_window_name(10080) ‚Üí "7d" ‚Üí "yang_zhang_7d" ‚úì
# _format_window_name(43200) ‚Üí "30d" ‚Üí "yang_zhang_30d" ‚úì
```
**–°—Ç–∞—Ç—É—Å:** ‚úì –ö–û–†–†–ï–ö–¢–ù–û (3/3)

#### 2.3 GARCH –ø—Ä–∏–∑–Ω–∞–∫–∏

```python
# –°—Ç—Ä–æ–∫–∞ 1029: norm_cols[4] = self._get_safe_float(row, "garch_200h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1030: norm_cols[5] = self._get_safe_float(row, "garch_14d", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1040: norm_cols[13] = self._get_safe_float(row, "garch_30d", 0.0)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ transformers.py (—Å—Ç—Ä–æ–∫–∏ 662-679):**
```python
# garch_windows_minutes = [12000, 20160, 43200]
# _format_window_name(12000) ‚Üí "200h" ‚Üí "garch_200h" ‚úì
# _format_window_name(20160) ‚Üí "14d" ‚Üí "garch_14d" ‚úì
# _format_window_name(43200) ‚Üí "30d" ‚Üí "garch_30d" ‚úì
```
**–°—Ç–∞—Ç—É—Å:** ‚úì –ö–û–†–†–ï–ö–¢–ù–û (3/3)

#### 2.4 Parkinson –ø—Ä–∏–∑–Ω–∞–∫–∏

```python
# –°—Ç—Ä–æ–∫–∞ 1038: norm_cols[11] = self._get_safe_float(row, "parkinson_48h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1039: norm_cols[12] = self._get_safe_float(row, "parkinson_7d", 0.0)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ transformers.py (—Å—Ç—Ä–æ–∫–∏ 643-660):**
```python
# parkinson_windows_minutes = [2880, 10080]
# _format_window_name(2880) ‚Üí "48h" ‚Üí "parkinson_48h" ‚úì
# _format_window_name(10080) ‚Üí "7d" ‚Üí "parkinson_7d" ‚úì
```
**–°—Ç–∞—Ç—É—Å:** ‚úì –ö–û–†–†–ï–ö–¢–ù–û (2/2)

#### 2.5 Returns –ø—Ä–∏–∑–Ω–∞–∫–∏

```python
# –°—Ç—Ä–æ–∫–∞ 1031: norm_cols[6] = self._get_safe_float(row, "ret_12h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1032: norm_cols[7] = self._get_safe_float(row, "ret_24h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1035: norm_cols[8] = self._get_safe_float(row, "ret_4h", 0.0)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ transformers.py (—Å—Ç—Ä–æ–∫–∏ 609-612):**
```python
# lookbacks_prices_minutes = [240, 720, 1200, 1440, 5040, 10080, 12000]
# _format_window_name(720) ‚Üí "12h" ‚Üí "ret_12h" ‚úì
# _format_window_name(1440) ‚Üí "24h" ‚Üí "ret_24h" ‚úì
# _format_window_name(240) ‚Üí "4h" ‚Üí "ret_4h" ‚úì
```
**–°—Ç–∞—Ç—É—Å:** ‚úì –ö–û–†–†–ï–ö–¢–ù–û (3/3)

#### 2.6 SMA –ø—Ä–∏–∑–Ω–∞–∫–∏

```python
# –°—Ç—Ä–æ–∫–∞ 1036: norm_cols[9] = self._get_safe_float(row, "sma_12000", 0.0)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ transformers.py (—Å—Ç—Ä–æ–∫–∞ 606):**
```python
# feats[f"sma_{lb_minutes}"] = float(sma)
# –≥–¥–µ lb_minutes = 12000 –¥–ª—è 200h –æ–∫–Ω–∞ ‚úì
```
**–°—Ç–∞—Ç—É—Å:** ‚úì –ö–û–†–†–ï–ö–¢–ù–û (1/1)

#### 2.7 Taker Buy Ratio –ø—Ä–∏–∑–Ω–∞–∫–∏

```python
# –°—Ç—Ä–æ–∫–∞ 1041: norm_cols[14] = self._get_safe_float(row, "taker_buy_ratio", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1042: norm_cols[15] = self._get_safe_float(row, "taker_buy_ratio_sma_24h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1045: norm_cols[16] = self._get_safe_float(row, "taker_buy_ratio_sma_8h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1046: norm_cols[17] = self._get_safe_float(row, "taker_buy_ratio_sma_16h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1047: norm_cols[18] = self._get_safe_float(row, "taker_buy_ratio_momentum_4h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1048: norm_cols[19] = self._get_safe_float(row, "taker_buy_ratio_momentum_8h", 0.0)
# –°—Ç—Ä–æ–∫–∞ 1049: norm_cols[20] = self._get_safe_float(row, "taker_buy_ratio_momentum_12h", 0.0)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ transformers.py:**
- `taker_buy_ratio_windows_minutes = [480, 960, 1440]`
- `_format_window_name(480) ‚Üí "8h" ‚Üí "taker_buy_ratio_sma_8h"` ‚úì
- `_format_window_name(960) ‚Üí "16h" ‚Üí "taker_buy_ratio_sma_16h"` ‚úì
- `_format_window_name(1440) ‚Üí "24h" ‚Üí "taker_buy_ratio_sma_24h"` ‚úì
- `taker_buy_ratio_momentum_minutes = [240, 480, 720, 1440]`
- `_format_window_name(240) ‚Üí "4h" ‚Üí "taker_buy_ratio_momentum_4h"` ‚úì
- `_format_window_name(480) ‚Üí "8h" ‚Üí "taker_buy_ratio_momentum_8h"` ‚úì
- `_format_window_name(720) ‚Üí "12h" ‚Üí "taker_buy_ratio_momentum_12h"` ‚úì

**–°—Ç–∞—Ç—É—Å:** ‚úì –ö–û–†–†–ï–ö–¢–ù–û (7/7)

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—ä–µ–º–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 936-955)

```python
# –°—Ç—Ä–æ–∫–∞ 942:
log_volume_norm = float(np.tanh(np.log1p(quote_volume / 240e6)))

# –°—Ç—Ä–æ–∫–∞ 948:
rel_volume = float(np.tanh(np.log1p(volume / 24000.0)))
```

**–ê–Ω–∞–ª–∏–∑:**
- 240e6 = 240 * 10^6 (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è quote volume –¥–ª—è 4h)
- 24000.0 (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è base volume –¥–ª—è 4h)
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Å—Ç. 936-945) –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—ä—è—Å–Ω—è—é—Ç: "4h bars aggregate ~240x more volume"
- –≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—É 240 (4h = 240 –º–∏–Ω—É—Ç = 240 * 1m)

**–°—Ç–∞—Ç—É—Å:** ‚úì –ö–û–†–†–ï–ö–¢–ù–û

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 957-1010)

```python
# –°—Ç—Ä–æ–∫–∞ 960: ma5 = self._get_safe_float(row, "sma_5", float('nan'))
# –°—Ç—Ä–æ–∫–∞ 961: # NOTE: For 4h timeframe using sma_21 (21 bars = 84h ‚âà weekly trend)
# –°—Ç—Ä–æ–∫–∞ 963: ma20 = self._get_safe_float(row, "sma_21", float('nan'))
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∞ —Å—Ç—Ä–æ–∫–µ 961 —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º, –Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è "sma_5" –∏ "sma_21" –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ 4h –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ!

**–°—Ç–∞—Ç—É—Å:** ‚ùå –ö–†–ò–¢–ò–ß–ù–ê–Ø –û–®–ò–ë–ö–ê (—Å–º. —Ä–∞–∑–¥–µ–ª 1)

---

## III. TRANSFORMERS.PY - –ê–ù–ê–õ–ò–ó

### ‚úì –°–¢–ê–¢–£–°: –ü–û–õ–ù–û–°–¢–¨–Æ –ö–û–†–†–ï–ö–¢–ï–ù

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è FeatureSpec

**FeatureSpec __post_init__ (—Å—Ç—Ä–æ–∫–∏ 315-467):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–µ—Ñ–æ–ª—Ç | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|-------|---------------|-----------|
| lookbacks_prices | [240,720,1200,1440,5040,10080,12000] | /240 | [1,3,5,6,21,42,50] –±–∞—Ä–æ–≤ | ‚úì |
| yang_zhang_windows | [2880,10080,43200] | /240 | [12,42,180] –±–∞—Ä–æ–≤ | ‚úì |
| parkinson_windows | [2880,10080] | /240 | [12,42] –±–∞—Ä–∞ | ‚úì |
| garch_windows | [12000,20160,43200] | /240 | [50,84,180] –±–∞—Ä–æ–≤ | ‚úì |
| taker_buy_ratio_windows | [480,960,1440] | /240 | [2,4,6] –±–∞—Ä–æ–≤ | ‚úì |
| taker_buy_ratio_momentum | [240,480,720,1440] | /240 | [1,2,3,6] –±–∞—Ä–æ–≤ | ‚úì |
| cvd_windows | [1440,10080] | /240 | [6,42] –±–∞—Ä–∞ | ‚úì |

**–§—É–Ω–∫—Ü–∏—è _format_window_name (—Å—Ç—Ä–æ–∫–∏ 15-46):**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–Ω–∏ (‚â•7 –¥–Ω–µ–π –∏ –∫—Ä–∞—Ç–Ω–æ 1440): "7d", "14d", "30d"
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∞—Å—ã (‚â•60 –º–∏–Ω –∏ –∫—Ä–∞—Ç–Ω–æ 60): "4h", "8h", "12h", "24h", "48h", "200h"
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –º–∏–Ω—É—Ç—ã (–æ—Å—Ç–∞–ª—å–Ω–æ–µ): "XXXm"

**–°—Ç–∞—Ç—É—Å:** ‚úì –í–°–ï –ü–†–ê–í–ò–õ–¨–ù–û

---

## –†–ï–ó–Æ–ú–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ü–†–û–ë–õ–ï–ú

### üî¥ –ö–†–ò–¢–ò–ß–ù–ê–Ø –û–®–ò–ë–ö–ê #1: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SMA –≤ mediator.py

**–§–∞–π–ª:** `/home/user/TradingBot2/mediator.py`
**–°—Ç—Ä–æ–∫–∏:** 960, 963
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫ "sma_5" –∏ "sma_21" –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–ª—è 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
**–¢–∏–ø:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ - –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ NaN –≤ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è—Ö
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø - –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ/–∏–Ω—Ñ–µ—Ä–µ–Ω—Å –º–æ–¥–µ–ª–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –í–∞—Ä–∏–∞–Ω—Ç –ê: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ SMA
ma5 = self._get_safe_float(row, "sma_240", float('nan'))      # 4h (1 –±–∞—Ä)
ma20 = self._get_safe_float(row, "sma_1440", float('nan'))    # 24h (6 –±–∞—Ä–æ–≤)

# –ò–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ –æ–∫–Ω–∞
ma5 = self._get_safe_float(row, "sma_240", float('nan'))      # 4h
ma20 = self._get_safe_float(row, "sma_10080", float('nan'))   # 7 –¥–Ω–µ–π (–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥)
```

---

## –ò–¢–û–ì–ò

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–±–ª–µ–º | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|------|--------|---------|-------------|
| make_features.py | ‚úì PASS | 0 | - |
| mediator.py | ‚ùå FAIL | 1 –∫—Ä–∏—Ç–∏—á–Ω–∞—è | üî¥ –í–´–°–û–ö–ê–Ø |
| transformers.py | ‚úì PASS | 0 | - |

**–û–±—â–µ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º –Ω–∞ 99% –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ, –Ω–æ –µ—Å—Ç—å –û–î–ù–ê –∫—Ä–∏—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ mediator.py, –∫–æ—Ç–æ—Ä–∞—è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

