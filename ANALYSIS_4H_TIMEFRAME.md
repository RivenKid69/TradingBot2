# АНАЛИЗ ВСЕХ 56 ПРИЗНАКОВ ДЛЯ ПЕРЕХОДА НА 4-ЧАСОВОЙ ИНТЕРВАЛ

**Дата анализа:** 2025-11-11
**Текущий интервал:** 1 минута (1m)
**Целевой интервал:** 4 часа (4h = 240 минут)
**Коэффициент изменения:** 1m → 4h = x240

---

## ВАЖНЫЕ ЗАМЕЧАНИЯ О ПЕРЕХОДЕ

### Принципиальные изменения:

1. **Временные окна**: Все окна, выраженные в минутах или часах, нужно пересчитать в количество баров
   - Текущий 1m бар = 1 минута реального времени
   - Новый 4h бар = 240 минут реального времени
   - Окно "60 минут" на 1m = 60 баров, на 4h = 0.25 бара (не имеет смысла!)

2. **Статистическая значимость**: На длинных таймфреймах меньше данных
   - 1 день на 1m = 1440 баров
   - 1 день на 4h = 6 баров
   - Требуются гораздо более длинные исторические периоды

3. **Волатильность и динамика**: Характер движений меняется
   - Внутри-дневной шум сглаживается
   - Тренды становятся более явными
   - Микроструктурные признаки теряют смысл

---

## ДЕТАЛЬНЫЙ АНАЛИЗ ВСЕХ 56 ПРИЗНАКОВ

---

### **ГРУППА 1: BAR LEVEL (индексы 0-2, всего 3)**

#### Признак 0: `price` (Цена закрытия)
- **Текущая конфигурация**: Цена закрытия текущего 1m бара
- **На 4h интервале**: Цена закрытия текущего 4h бара
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМ**
- **Требуемые изменения**: НЕТ
- **Комментарий**: Цена — базовый признак, независимый от таймфрейма

#### Признак 1: `log_volume_norm` (Логарифм нормализованного объема)
- **Текущая конфигурация**: tanh(log1p(quote_volume/1e6))
- **На 4h интервале**: Объем будет в ~240 раз больше (агрегирован за 4 часа)
- **Применимость**: ⚠️ **ТРЕБУЕТ КОРРЕКТИРОВКИ**
- **Требуемые изменения**:
  - Изменить коэффициент нормализации с 1e6 на ~240e6 (или откалибровать заново)
  - Или использовать adaptive normalization
- **Комментарий**: Объем на 4h барах будет значительно выше, нужна перекалибровка

#### Признак 2: `rel_volume` (Относительный объем)
- **Текущая конфигурация**: tanh(log1p(volume/100))
- **На 4h интервале**: Аналогично log_volume_norm
- **Применимость**: ⚠️ **ТРЕБУЕТ КОРРЕКТИРОВКИ**
- **Требуемые изменения**:
  - Изменить коэффициент с 100 на ~24000 (100 * 240)
  - Или откалибровать на реальных данных 4h
- **Комментарий**: Базовый объем нужно масштабировать

---

### **ГРУППА 2: INDICATORS (индексы 3-15, всего 13)**

#### Признак 3: `ma5` (SMA-5)
- **Текущая конфигурация**: Скользящее среднее за 5 минут = 5 баров на 1m
- **На 4h интервале**: 5 баров на 4h = 20 часов
- **Применимость**: ⚠️ **ТРЕБУЕТ ПЕРЕСЧЕТА ОКНА**
- **Требуемые изменения**:
  - **Вариант 1**: Использовать окно 3-5 баров (12-20 часов) — краткосрочный MA
  - **Вариант 2**: Использовать окно 7 баров (28 часов ≈ 1 день) — дневной MA
  - **Вариант 3**: Использовать окно 12 баров (48 часов = 2 дня)
- **Рекомендация**: **5 баров на 4h** (20 часов) — аналог краткосрочного MA

#### Признак 4: `ma5_valid` (Флаг валидности MA5)
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМ**
- **Требуемые изменения**: НЕТ

#### Признак 5: `ma20` (SMA-15, используется как MA20)
- **Текущая конфигурация**: sma_15 = 15 минут = 15 баров на 1m
- **На 4h интервале**: 15 баров на 4h = 60 часов = 2.5 дня
- **Применимость**: ⚠️ **ТРЕБУЕТ ПЕРЕСЧЕТА ОКНА**
- **Требуемые изменения**:
  - **Вариант 1**: Использовать окно 20-25 баров (80-100 часов ≈ 4 дня) — среднесрочный MA
  - **Вариант 2**: Использовать окно 42 баров (168 часов = 7 дней) — недельный MA
  - **Вариант 3**: Использовать окно 30 баров (120 часов = 5 дней)
- **Рекомендация**: **21 баров на 4h** (84 часа ≈ 3.5 дня) — классический среднесрочный MA

#### Признак 6: `ma20_valid` (Флаг валидности MA20)
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМ**
- **Требуемые изменения**: НЕТ

#### Признак 7: `rsi14` (RSI индикатор)
- **Текущая конфигурация**: RSI с периодом 14 минут = 14 баров на 1m
- **На 4h интервале**: 14 баров на 4h = 56 часов
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМ**
- **Требуемые изменения**: Стандартный RSI(14) используется на всех таймфреймах
- **Комментарий**: 14 — классический период для RSI, работает на любом таймфрейме

#### Признаки 8-13: `macd`, `macd_signal`, `momentum`, `atr`, `cci`, `obv`
- **Текущая конфигурация**: Зависят от MarketSimulator (внутренние расчеты)
- **На 4h интервале**: Зависят от реализации в MarketSimulator
- **Применимость**: ⚠️ **ЗАВИСИТ ОТ РЕАЛИЗАЦИИ**
- **Требуемые изменения**:
  - Проверить параметры расчета в MarketSimulator
  - Адаптировать окна для каждого индикатора:
    - **MACD**: 12/26/9 баров — стандартные параметры работают на любом таймфрейме
    - **ATR**: 14 баров — стандартный период
    - **CCI**: 20 баров — стандартный период
    - **OBV**: накопительный, не зависит от таймфрейма
    - **Momentum**: требует определения периода
- **Рекомендация**: Использовать стандартные периоды, они универсальны

#### Признаки 14-15: `bb_position`, `bb_width_rel` (Bollinger Bands)
- **Текущая конфигурация**: Зависят от MarketSimulator
- **На 4h интервале**: Стандартные Bollinger Bands (20 период, 2 std)
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМ**
- **Требуемые изменения**: Стандартные параметры BB(20,2) работают на любом таймфрейме

---

### **ГРУППА 3: DERIVED (индексы 16-17, всего 2)**

#### Признак 16: `ret_1h` (Доходность за 1 час)
- **Текущая конфигурация**: (price - prev_price) / prev_price за 1 минуту
- **На 4h интервале**: (price - prev_price) / prev_price за 4 часа
- **Применимость**: ⚠️ **ТРЕБУЕТ ПЕРЕИМЕНОВАНИЯ**
- **Требуемые изменения**:
  - Переименовать в `ret_4h` (доходность за 4 часа)
  - Для сохранения аналогии с 1h доходностью нужен дополнительный расчет
  - **Вариант 1**: Добавить расчет ret между текущей и (текущая - 1) барами = ret_4h
  - **Вариант 2**: Добавить расчет ret между текущей и (текущая - 6) барами = ret_24h
- **Рекомендация**: Использовать **ret_4h** (1 бар) и **ret_24h** (6 баров)

#### Признак 17: `vol_proxy` (Прокси волатильности)
- **Текущая конфигурация**: tanh(log1p(atr/price))
- **На 4h интервале**: ATR будет больше (так как больше диапазон)
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМ**
- **Требуемые изменения**: НЕТ
- **Комментарий**: Нормализация через price делает признак масштабо-инвариантным

---

### **ГРУППА 4: MICROSTRUCTURE (индексы 18-20, всего 3)**

#### Признаки 18-20: `ofi_proxy`, `qimb`, `micro_dev`
- **Текущая конфигурация**: Микроструктурные признаки для высокочастотной торговли
- **На 4h интервале**: ❌ **ТЕРЯЮТ СМЫСЛ**
- **Применимость**: ❌ **НЕ ПРИМЕНИМЫ**
- **Требуемые изменения**:
  - **Вариант 1**: УДАЛИТЬ (заменить нулями или константами)
  - **Вариант 2**: ЗАМЕНИТЬ на макро-индикаторы (например, correlation, regime indicators)
  - **Вариант 3**: Использовать свечные паттерны (doji, hammer, etc.)
- **Рекомендация**: **ЗАМЕНИТЬ** на признаки, релевантные для 4h (макро-тренды, режимы рынка)
- **Комментарий**: Order flow imbalance и microstructure deviation не имеют смысла на 4h

---

### **ГРУППА 5: AGENT STATE (индексы 21-26, всего 6)**

#### Признаки 21-26: `cash_ratio`, `position_ratio`, `vol_imbalance`, `trade_intensity`, `realized_spread`, `agent_fill_ratio`
- **Текущая конфигурация**: Состояние агента (портфель, позиции, метрики исполнения)
- **На 4h интервале**: Состояние портфеля не зависит от таймфрейма
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМЫ**
- **Требуемые изменения**: НЕТ
- **Комментарий**: Портфельные метрики универсальны

---

### **ГРУППА 6: METADATA (индексы 27-31, всего 5)**

#### Признаки 27-31: `is_high_importance`, `time_since_event`, `risk_off_flag`, `fear_greed_value`, `fear_greed_indicator`
- **Текущая конфигурация**: Метаданные событий и макро-индикаторы
- **На 4h интервале**: Применимы, но могут требовать корректировки частоты обновления
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМЫ**
- **Требуемые изменения**:
  - `time_since_event`: Возможно, потребуется другая нормализация (tanh(x/6) вместо tanh(x/24))
- **Комментарий**: Fear & Greed Index обновляется дискретно, не зависит от таймфрейма

---

### **ГРУППА 7: EXTERNAL (norm_cols) (индексы 32-52, всего 21)**

Это самая критичная группа для анализа, так как все временные окна заданы явно.

#### Признаки 32-33: `cvd_24h`, `cvd_168h` (Cumulative Volume Delta)
- **Текущая конфигурация**:
  - cvd_24h: окно 1440 минут = 1440 баров на 1m = 24 часа
  - cvd_168h: окно 10080 минут = 10080 баров на 1m = 168 часов (7 дней)
- **На 4h интервале**:
  - 24 часа = 6 баров на 4h
  - 168 часов = 42 бара на 4h
- **Применимость**: ⚠️ **ТРЕБУЕТ ПЕРЕСЧЕТА ОКОН**
- **Требуемые изменения**:
  - `cvd_24h`: окно 6 баров (24 часа)
  - `cvd_168h`: окно 42 бара (168 часов = 7 дней)
- **Рекомендация**: Сохранить те же временные периоды (24h, 7d), пересчитать в барах
- **Комментарий**: CVD — накопительная метрика, важна для определения дисбаланса покупок/продаж

#### Признаки 34-35, 42: `yang_zhang_24h`, `yang_zhang_168h`, `yang_zhang_720h` (Yang-Zhang Volatility)
- **Текущая конфигурация**:
  - yang_zhang_24h: окно 1440 минут = 1440 баров на 1m = 24 часа
  - yang_zhang_168h: окно 10080 минут = 168 часов (7 дней)
  - yang_zhang_720h: окно 43200 минут = 720 часов (30 дней)
- **На 4h интервале**:
  - 24 часа = 6 баров
  - 168 часов = 42 бара
  - 720 часов = 180 баров
- **Применимость**: ⚠️ **ТРЕБУЕТ ПЕРЕСЧЕТА ОКОН**
- **Требуемые изменения**:
  - `yang_zhang_24h`: окно 6 баров (24 часа)
  - `yang_zhang_168h`: окно 42 бара (7 дней)
  - `yang_zhang_720h`: окно 180 баров (30 дней)
- **Рекомендация**: Yang-Zhang требует OHLC данные, которые доступны на любом таймфрейме
- **Комментарий**: ⚠️ **КРИТИЧНО**: На коротких окнах (6 баров) точность Yang-Zhang снижается
  - Минимум рекомендуется 20+ баров для стабильных оценок
  - **Альтернатива для 24h**: Использовать окно 2-3 дня (12-18 баров) вместо 24h (6 баров)

#### Признаки 43-44: `parkinson_24h`, `parkinson_168h` (Parkinson Volatility)
- **Текущая конфигурация**:
  - parkinson_24h: окно 1440 минут = 24 часа
  - parkinson_168h: окно 10080 минут = 7 дней
- **На 4h интервале**:
  - 24 часа = 6 баров
  - 168 часов = 42 бара
- **Применимость**: ⚠️ **ТРЕБУЕТ ПЕРЕСЧЕТА ОКОН**
- **Требуемые изменения**:
  - `parkinson_24h`: окно 6 баров (24 часа) — **НО ЛУЧШЕ 12-18 баров**
  - `parkinson_168h`: окно 42 бара (7 дней)
- **Рекомендация**: Аналогично Yang-Zhang, лучше использовать более длинные окна
  - `parkinson_48h`: окно 12 баров (48 часов = 2 дня)
  - `parkinson_168h`: окно 42 бара (7 дней)

#### Признаки 36-37, 45: `garch_12h`, `garch_24h`, `garch_500m` (GARCH Volatility)
- **Текущая конфигурация**:
  - garch_12h: окно 720 минут = 12 часов
  - garch_24h: окно 1440 минут = 24 часа
  - garch_500m: окно 500 минут ≈ 8.3 часа
- **На 4h интервале**:
  - 12 часов = 3 бара
  - 24 часа = 6 баров
  - 8.3 часа = 2.08 бара
- **Применимость**: ❌ **НЕ ПРИМЕНИМЫ С ТЕКУЩИМИ ОКНАМИ**
- **Требуемые изменения**:
  - **GARCH требует минимум 50-100 наблюдений для стабильной оценки!**
  - На 4h это означает 50 * 4h = 200 часов = 8.3 дня (минимум)
  - Рекомендуемое окно: 100-200 баров = 400-800 часов = 16-33 дня
- **Рекомендация**:
  - **Вариант 1**: `garch_7d` (окно 42 бара), `garch_14d` (84 бара), `garch_30d` (180 баров)
  - **Вариант 2**: УДАЛИТЬ GARCH (заменить на более простые метрики волатильности)
- **Комментарий**: ⚠️ **КРИТИЧНО**: GARCH на коротких окнах не работает!
  - На 1m данных 500-1440 минут = 500-1440 наблюдений (достаточно)
  - На 4h данных 3-6 баров = НЕДОСТАТОЧНО для GARCH

#### Признаки 38-40: `ret_15m`, `ret_60m`, `ret_5m` (Returns)
- **Текущая конфигурация**:
  - ret_5m: окно 5 минут = 5 баров на 1m
  - ret_15m: окно 15 минут = 15 баров на 1m
  - ret_60m: окно 60 минут = 60 баров на 1m
- **На 4h интервале**:
  - 5 минут = 0.02 бара (НЕ ИМЕЕТ СМЫСЛА)
  - 15 минут = 0.06 бара (НЕ ИМЕЕТ СМЫСЛА)
  - 60 минут = 0.25 бара (НЕ ИМЕЕТ СМЫСЛА)
- **Применимость**: ❌ **НЕ ПРИМЕНИМЫ С ТЕКУЩИМИ ПЕРИОДАМИ**
- **Требуемые изменения**:
  - Заменить на ретёрны с разных временных горизонтов:
    - `ret_4h`: окно 1 бар (доходность за один 4h бар)
    - `ret_12h`: окно 3 бара (доходность за 12 часов)
    - `ret_24h`: окно 6 баров (доходность за 1 день)
    - `ret_7d`: окно 42 бара (доходность за неделю)
- **Рекомендация**: **ЗАМЕНИТЬ** на ret_4h, ret_12h, ret_24h, ret_7d
- **Комментарий**: Короткие внутри-барные ретёрны на 4h не существуют

#### Признак 41: `sma_60` (SMA за 60 минут)
- **Текущая конфигурация**: окно 60 минут = 60 баров на 1m
- **На 4h интервале**: 60 минут = 0.25 бара (НЕ ИМЕЕТ СМЫСЛА)
- **Применимость**: ❌ **НЕ ПРИМЕНИМО**
- **Требуемые изменения**:
  - Заменить на более длинный SMA:
    - `sma_50` (50 баров = 200 часов ≈ 8 дней) — классический SMA50
    - `sma_100` (100 баров = 400 часов ≈ 16 дней)
    - `sma_200` (200 баров = 800 часов ≈ 33 дня) — классический SMA200
- **Рекомендация**: Использовать `sma_50` и/или `sma_200` (классические периоды в трейдинге)

#### Признаки 46-47, 48-49: Taker Buy Ratio (текущий и SMA)
- **Текущая конфигурация**:
  - taker_buy_ratio: текущее значение
  - taker_buy_ratio_sma_6h: окно 360 минут = 6 часов
  - taker_buy_ratio_sma_12h: окно 720 минут = 12 часов
  - taker_buy_ratio_sma_24h: окно 1440 минут = 24 часа
- **На 4h интервале**:
  - текущее значение: агрегировано за 4 часа (применимо)
  - 6 часов = 1.5 бара
  - 12 часов = 3 бара
  - 24 часа = 6 баров
- **Применимость**: ⚠️ **ТРЕБУЕТ КОРРЕКТИРОВКИ ОКОН**
- **Требуемые изменения**:
  - `taker_buy_ratio`: ✅ применимо (текущее соотношение за 4h бар)
  - `taker_buy_ratio_sma_8h`: окно 2 бара
  - `taker_buy_ratio_sma_16h`: окно 4 бара
  - `taker_buy_ratio_sma_24h`: окно 6 баров
- **Рекомендация**: Округлить окна до целых баров
  - SMA за 2/4/6 баров (8h/16h/24h)
- **Комментарий**: Taker Buy Ratio показывает агрессивность покупателей/продавцов

#### Признаки 50-52: Taker Buy Ratio Momentum
- **Текущая конфигурация**:
  - momentum_1h: окно 60 минут = 1 час
  - momentum_6h: окно 360 минут = 6 часов
  - momentum_12h: окно 720 минут = 12 часов
- **На 4h интервале**:
  - 1 час = 0.25 бара (НЕ ИМЕЕТ СМЫСЛА)
  - 6 часов = 1.5 бара
  - 12 часов = 3 бара
- **Применимость**: ⚠️ **ТРЕБУЕТ КОРРЕКТИРОВКИ ОКОН**
- **Требуемые изменения**:
  - `momentum_4h`: окно 1 бар
  - `momentum_8h`: окно 2 бара
  - `momentum_12h`: окно 3 бара
  - `momentum_24h`: окно 6 баров (новый)
- **Рекомендация**: Использовать 1/2/3/6 баров (4h/8h/12h/24h)

---

### **ГРУППА 8: TOKEN METADATA & ONE-HOT (индексы 53-55, всего 3)**

#### Признаки 53-55: `num_tokens_norm`, `token_id_norm`, `token[0]`
- **Текущая конфигурация**: Метаданные токенов (для multi-asset)
- **На 4h интервале**: Не зависят от таймфрейма
- **Применимость**: ✅ **ПОЛНОСТЬЮ ПРИМЕНИМЫ**
- **Требуемые изменения**: НЕТ

---

## СВОДНАЯ ТАБЛИЦА ИЗМЕНЕНИЙ

| Категория | Признаков | Применимы без изменений | Требуют корректировки | Не применимы | Новые |
|-----------|-----------|------------------------|---------------------|--------------|-------|
| Bar Level | 3 | 1 | 2 | 0 | 0 |
| Indicators | 13 | 5 | 6 | 2 | 0 |
| Derived | 2 | 1 | 1 | 0 | 1 |
| Microstructure | 3 | 0 | 0 | 3 | 3 |
| Agent State | 6 | 6 | 0 | 0 | 0 |
| Metadata | 5 | 4 | 1 | 0 | 0 |
| External (norm_cols) | 21 | 0 | 15 | 6 | 6 |
| Token | 3 | 3 | 0 | 0 | 0 |
| **ИТОГО** | **56** | **20** | **25** | **11** | **10** |

---

## КРИТИЧЕСКИЕ ПРОБЛЕМЫ

### ❌ Признаки, которые НЕ ПРИМЕНИМЫ на 4h:

1. **Микроструктурные признаки (3 шт.)**:
   - `ofi_proxy`, `qimb`, `micro_dev`
   - **Причина**: Требуют высокочастотные данные (order flow)
   - **Решение**: УДАЛИТЬ или ЗАМЕНИТЬ на свечные паттерны

2. **GARCH волатильности с короткими окнами (3 шт.)**:
   - `garch_500m`, `garch_12h`, `garch_24h`
   - **Причина**: GARCH требует минимум 50-100 наблюдений
   - **Решение**: Использовать окна 7d/14d/30d или УДАЛИТЬ

3. **Короткие ретёрны (3 шт.)**:
   - `ret_5m`, `ret_15m`, `ret_60m`
   - **Причина**: Меньше одного 4h бара
   - **Решение**: ЗАМЕНИТЬ на ret_4h/ret_12h/ret_24h/ret_7d

4. **SMA60 (1 шт.)**:
   - `sma_60` (60 минут = 0.25 бара)
   - **Причина**: Меньше одного бара
   - **Решение**: ЗАМЕНИТЬ на sma_50 или sma_200 (классические периоды)

5. **Taker Buy Ratio Momentum 1h (1 шт.)**:
   - `taker_buy_ratio_momentum_1h`
   - **Причина**: 1 час = 0.25 бара
   - **Решение**: ЗАМЕНИТЬ на momentum_4h

---

## РЕКОМЕНДУЕМАЯ НОВАЯ КОНФИГУРАЦИЯ ДЛЯ 4H

### Новые временные окна:

```python
# Для 4h интервала (1 бар = 4 часа = 240 минут)

# SMA (в барах):
lookbacks_prices = [5, 21, 50]  # 20h, 84h (3.5d), 200h (8.3d)

# RSI:
rsi_period = 14  # Стандартный период, универсален

# Yang-Zhang волатильность (в барах):
yang_zhang_windows = [12, 42, 180]  # 48h (2d), 168h (7d), 720h (30d)

# Parkinson волатильность (в барах):
parkinson_windows = [12, 42]  # 48h (2d), 168h (7d)

# GARCH волатильность (в барах) — ЛИБО ИСПОЛЬЗОВАТЬ ДЛИННЫЕ ОКНА, ЛИБО УДАЛИТЬ:
# ВАРИАНТ 1 (длинные окна):
garch_windows = [42, 84, 180]  # 7d, 14d, 30d
# ВАРИАНТ 2 (удалить):
garch_windows = []  # Не использовать GARCH на 4h

# Taker Buy Ratio SMA (в барах):
taker_buy_ratio_windows = [2, 4, 6]  # 8h, 16h, 24h

# Taker Buy Ratio Momentum (в барах):
taker_buy_ratio_momentum = [1, 2, 3, 6]  # 4h, 8h, 12h, 24h

# CVD (в барах):
cvd_windows = [6, 42]  # 24h, 168h (7d)

# Новые ретёрны (в барах):
returns_windows = [1, 3, 6, 42]  # 4h, 12h, 24h, 7d
```

### Пересчет окон из минут в бары:

Для 4h интервала коэффициент пересчета: **окно_в_минутах / 240 = окно_в_барах**

Примеры:
- 1440 минут (24h) → 6 баров
- 10080 минут (7d) → 42 бара
- 43200 минут (30d) → 180 баров

---

## ПЛАН ДЕЙСТВИЙ

### Этап 1: Корректировка конфигурации

1. ✅ Обновить `FeatureSpec` в `transformers.py`:
   - Пересчитать все временные окна с учетом 4h интервала
   - Добавить новые признаки (ret_4h, ret_12h, etc.)
   - Удалить неприменимые (GARCH с короткими окнами, ret_5m/15m/60m)

2. ✅ Обновить `feature_config.py`:
   - Пересчитать `EXT_NORM_DIM` (может измениться)
   - Обновить layout для новых признаков

3. ✅ Обновить `mediator.py`:
   - Изменить `_extract_norm_cols` под новый список признаков
   - Корректировать нормализацию объемов

### Этап 2: Замена микроструктурных признаков

4. ⚠️ РЕШИТЬ: Чем заменить `ofi_proxy`, `qimb`, `micro_dev`?
   - **Вариант A**: Свечные паттерны (doji, hammer, engulfing, etc.)
   - **Вариант B**: Макро-индикаторы (correlation, regime detection)
   - **Вариант C**: Технические паттерны (support/resistance, breakouts)
   - **Вариант D**: Просто удалить (заполнить нулями)

### Этап 3: Обновление данных

5. ✅ Подготовить новый dataset:
   - Ресемплировать 1m данные в 4h бары
   - Пересчитать все признаки с новыми окнами
   - Проверить корректность OHLC агрегации

6. ✅ Проверить volume/taker_buy_base:
   - Убедиться, что объемы корректно суммируются при агрегации
   - Проверить taker_buy_ratio на 4h барах

### Этап 4: Переобучение модели

7. ⚠️ КРИТИЧНО: Модель нужно переобучить с нуля!
   - Текущая модель обучена на 1m паттернах
   - 4h паттерны совершенно другие
   - Нужны новые данные и долгое обучение

---

## ФИНАЛЬНЫЕ РЕКОМЕНДАЦИИ

### ⚠️ ВАЖНО:

1. **GARCH на 4h**: Либо использовать окна 7-30 дней, либо УДАЛИТЬ
2. **Микроструктура**: УДАЛИТЬ или ЗАМЕНИТЬ на свечные паттерны
3. **Короткие ретёрны**: ЗАМЕНИТЬ на ret_4h/12h/24h/7d
4. **Объемы**: ПЕРЕКАЛИБРОВАТЬ нормализацию
5. **Модель**: Обязательно ПЕРЕОБУЧИТЬ с нуля

### ✅ ПРЕИМУЩЕСТВА 4H:

- Меньше шума, более четкие тренды
- Меньше ложных сигналов
- Меньше транзакционных издержек
- Больше времени на принятие решений

### ❌ НЕДОСТАТКИ 4H:

- Меньше торговых возможностей
- Больше риск на сделку (больший стоп-лосс)
- Требуется длинная история для обучения
- Потеря микроструктурной информации

---

**ИТОГ**: Переход на 4h интервал **ВОЗМОЖЕН**, но требует **значительной переработки** системы признаков.

Около **40% признаков** (22 из 56) требуют либо корректировки окон, либо полной замены.

Рекомендуется начать с пилотного тестирования на небольшом наборе данных для валидации новой конфигурации.
