# КРИТИЧЕСКИЙ АНАЛИЗ: time_since_event нормализация

## ВОПРОС: В каких единицах измеряется time_since_event?

### Из документации (OBSERVATION_MAPPING.md):
```
"Hours since last major event"
```
**→ time_since_event измеряется в ЧАСАХ**

---

## ТЕСТ: Что означают разные делители?

### Вариант 1: time_since_event в ЧАСАХ (вероятно)

#### Для 1h таймфрейма (делитель 24.0):
- Событие 6 часов назад: tanh(6/24) = tanh(0.25) ≈ 0.245
- Событие 12 часов назад: tanh(12/24) = tanh(0.5) ≈ 0.462
- Событие 24 часа назад: tanh(24/24) = tanh(1.0) ≈ 0.762
- Событие 48 часов назад: tanh(48/24) = tanh(2.0) ≈ 0.964

#### Для 4h таймфрейма (делитель 24.0 - БЕЗ изменений):
- Событие 6 часов назад: tanh(6/24) = tanh(0.25) ≈ 0.245  ← ТА ЖЕ СЕМАНТИКА
- Событие 12 часов назад: tanh(12/24) = tanh(0.5) ≈ 0.462 ← ТА ЖЕ СЕМАНТИКА
- Событие 24 часа назад: tanh(24/24) = tanh(1.0) ≈ 0.762  ← ТА ЖЕ СЕМАНТИКА
- Событие 48 часов назад: tanh(48/24) = tanh(2.0) ≈ 0.964 ← ТА ЖЕ СЕМАНТИКА

#### Для 4h таймфрейма (делитель 6.0 - С изменением):
- Событие 6 часов назад: tanh(6/6) = tanh(1.0) ≈ 0.762   ← НАМНОГО СИЛЬНЕЕ!
- Событие 12 часов назад: tanh(12/6) = tanh(2.0) ≈ 0.964 ← ПОЧТИ НАСЫЩЕНИЕ!
- Событие 24 часа назад: tanh(24/6) = tanh(4.0) ≈ 0.999  ← ПОЛНОЕ НАСЫЩЕНИЕ!
- Событие 48 часов назад: tanh(48/6) = tanh(8.0) ≈ 1.000 ← ПОЛНОЕ НАСЫЩЕНИЕ!

**ВЫВОД:** С делителем 6.0 события забываются в **4 раза быстрее**!

---

### Вариант 2: time_since_event в БАРАХ (маловероятно)

#### Для 1h таймфрейма (делитель 24.0):
- Событие 6 баров назад (6 часов): tanh(6/24) ≈ 0.245
- Событие 24 бара назад (24 часа): tanh(24/24) ≈ 0.762

#### Для 4h таймфрейма (делитель 6.0):
- Событие 6 баров назад (24 часа): tanh(6/6) ≈ 0.762  ← ТА ЖЕ СЕМАНТИКА В ЧАСАХ!
- Событие 24 бара назад (96 часов): tanh(24/6) ≈ 0.999

**ВЫВОД:** Если time_since_event в барах, то делитель 6 для 4h **ПРАВИЛЬНЫЙ**
(сохраняет ту же временную шкалу ~24 часа)

---

## ПРОВЕРКА: Что говорит комментарий в config_4h_timeframe.py?

```python
# На 1m использовалось: tanh(time_since_event / 24)
# На 4h можно использовать меньший делитель, так как один бар = 4 часа

TIME_SINCE_EVENT_DIVISOR = 6  # tanh(time_since_event / 6)
# Это нормализует события в пределах ~24 часов (6 баров * 4 часа)
```

**Интерпретация комментария:**
- "6 баров * 4 часа = 24 часа"
- Это намекает, что для 4h таймфрейма 6 баров = 24 часа
- Следовательно, если time_since_event в барах, то 6 баров на 4h = 24 часа на 1h

---

## КРИТИЧЕСКИЙ ВОПРОС: На 1m таймфрейме что означал делитель 24?

### Если time_since_event был в ЧАСАХ на 1m:
- Делитель 24 = нормализация в пределах 24 часов ✓ (логично)

### Если time_since_event был в БАРАХ на 1m:
- Делитель 24 = нормализация в пределах 24 баров = 24 МИНУТЫ ❌ (слишком мало!)
- Для финансовых событий (новости и т.д.) влияние длится ЧАСЫ, не минуты

**ВЫВОД:** На 1m time_since_event скорее всего был в **ЧАСАХ**, не барах!

---

## ФИНАЛЬНЫЙ ВЫВОД

### Если time_since_event в ЧАСАХ (ВЕРОЯТНО):
- ❌ Мое исправление (24.0 → 6.0) **НЕПРАВИЛЬНОЕ**
- Это заставляет события забываться в 4 раза быстрее
- Семантика меняется: вместо "события влияют ~24 часа" → "события влияют ~6 часов"

### Если time_since_event в БАРАХ (МАЛОВЕРОЯТНО):
- ✅ Мое исправление (24.0 → 6.0) **ПРАВИЛЬНОЕ**
- Это сохраняет ту же временную шкалу ~24 часа

---

## РЕКОМЕНДАЦИЯ

**ОТКАТИТЬ МОЕ ИСПРАВЛЕНИЕ** до проверки реальных данных!

Нужно проверить:
1. Где создается `time_since_event` в данных
2. В каких единицах оно измеряется
3. Какие значения оно принимает (часы? бары? минуты?)

**АЛЬТЕРНАТИВА:** Если time_since_event в часах и цель - сохранить семантику,
то для 4h таймфрейма нужно **ОСТАВИТЬ делитель 24.0**, а не менять на 6.0!
