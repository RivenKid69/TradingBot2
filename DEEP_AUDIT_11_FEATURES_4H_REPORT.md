# –ì–ª—É–±–æ–∫–∏–π –∞—É–¥–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ 11 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è 4h –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2025-11-12
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** transformers.py, obs_builder.pyx, mediator.py, make_features.py

---

## EXECUTIVE SUMMARY

**–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º:**
- üî¥ **CRITICAL: 1** - –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º–µ–Ω –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ GARCH –º–µ–∂–¥—É transformers.py –∏ mediator.py
- üü° **MAJOR: 1** - –ù–µ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ –æ–∫–Ω–∞–º GARCH
- üü¢ **MINOR: 0** - –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

**–°—Ç–∞—Ç—É—Å:** ‚ùå **–¢–†–ï–ë–£–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

---

## 1. –°–ò–ù–¢–ê–ö–°–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê

### ‚úÖ transformers.py

#### Yang-Zhang –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (—Å—Ç—Ä–æ–∫–∏ 49-137)

**–§–æ—Ä–º—É–ª–∞:**
```python
œÉ¬≤_YZ = œÉ¬≤_o + k¬∑œÉ¬≤_c + (1-k)¬∑œÉ¬≤_rs
–≥–¥–µ k = 0.34
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 76: `k = 0.34` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 90: `sigma_o_sq = sum((r - mean_overnight) ** 2 for r in overnight_returns) / (len(overnight_returns) - 1)` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 104: `sigma_c_sq = sum((r - mean_oc) ** 2 for r in oc_returns) / (len(oc_returns) - 1)` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 125: `sigma_rs_sq = rs_sum / rs_count` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–ª–∏–¥–Ω—ã—Ö –±–∞—Ä–æ–≤)
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 128: `sigma_yz_sq = sigma_o_sq + k * sigma_c_sq + (1 - k) * sigma_rs_sq` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 134: `return math.sqrt(sigma_yz_sq)` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 68: `if not ohlc_bars or len(ohlc_bars) < n or n < 2: return None`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 86-87: `if len(overnight_returns) < 2: return None`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 100-101: `if len(oc_returns) < 2: return None`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 122-123: `if rs_count == 0: return None`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 131-132: `if sigma_yz_sq < 0: return None`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 136: `except (ValueError, ZeroDivisionError, ArithmeticError): return None`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

#### Parkinson –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (—Å—Ç—Ä–æ–∫–∏ 140-192)

**–§–æ—Ä–º—É–ª–∞:**
```python
œÉ¬≤ = (1/(4n¬∑ln(2))) ¬∑ Œ£(ln(H_i/L_i))¬≤
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 186: `parkinson_var = sum_sq / (4 * valid_bars * math.log(2))` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `valid_bars` –≤–º–µ—Å—Ç–æ `n` –¥–ª—è —É—á–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 189: `return math.sqrt(parkinson_var)` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 157: `if not ohlc_bars or len(ohlc_bars) < n or n < 2: return None`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 172: `if high > 0 and low > 0 and high >= low:` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 180-182: `min_required = max(2, int(0.8 * n))` - —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 80% –≤–∞–ª–∏–¥–Ω—ã—Ö –±–∞—Ä–æ–≤
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 191: `except (ValueError, ZeroDivisionError, ArithmeticError): return None`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

#### GARCH –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (—Å—Ç—Ä–æ–∫–∏ 195-274)

**–ú–æ–¥–µ–ª—å:**
```python
GARCH(1,1):
r_t = Œº + Œµ_t
Œµ_t = œÉ_t * z_t, –≥–¥–µ z_t ~ N(0,1)
œÉ¬≤_t = œâ + Œ±*Œµ¬≤_{t-1} + Œ≤*œÉ¬≤_{t-1}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 242-249: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ `p=1, q=1, rescale=False` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 261: `forecast = result.forecast(horizon=1, reindex=False)` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 268: `forecast_volatility = np.sqrt(forecast_variance) / 100` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 215: `if not prices or len(prices) < n or n < 50: return None` - –º–∏–Ω–∏–º—É–º 50 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 223: `if np.any(price_window <= 0) or np.any(~np.isfinite(price_window)): return None`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 230-231: `if np.std(log_returns) < 1e-10: return None` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞—Ä–∏–∞—Ü–∏–∏
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 264-265: `if not np.isfinite(forecast_variance) or forecast_variance <= 0: return None`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 272: `except (ValueError, RuntimeError, np.linalg.LinAlgError, Exception): return None`

**üü° –ü–†–û–ë–õ–ï–ú–ê #1 (MAJOR): –ù–µ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö**

**–§–∞–π–ª:** transformers.py
**–°—Ç—Ä–æ–∫–∏:** 445-447

**–û–ø–∏—Å–∞–Ω–∏–µ:**
```python
# 8d = 50 –±–∞—Ä–æ–≤ = 12000 –º–∏–Ω—É—Ç (–º–∏–Ω–∏–º—É–º –¥–ª—è GARCH)
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 50 –±–∞—Ä–æ–≤ * 240 –º–∏–Ω—É—Ç/–±–∞—Ä = 12000 –º–∏–Ω—É—Ç = 200 —á–∞—Å–æ–≤ = 8.33 –¥–Ω—è
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–∫–∞–∑—ã–≤–∞–µ—Ç "8d", –Ω–æ —Ä–µ–∞–ª—å–Ω–æ —ç—Ç–æ 8.33 –¥–Ω—è (–Ω–µ —Ä–æ–≤–Ω–æ 8 –¥–Ω–µ–π)
- 8 –¥–Ω–µ–π = 11520 –º–∏–Ω—É—Ç, —á—Ç–æ –±—ã–ª–æ –±—ã 48 –±–∞—Ä–æ–≤

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# 50 –±–∞—Ä–æ–≤ (8.33d) = 12000 –º–∏–Ω—É—Ç (–º–∏–Ω–∏–º—É–º –¥–ª—è GARCH)
```

**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** MAJOR (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –Ω–æ —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**

---

### ‚úÖ obs_builder.pyx (—Å—Ç—Ä–æ–∫–∏ 1-318)

#### –¢–∏–ø—ã Cython (—Å—Ç—Ä–æ–∫–∏ 68-70)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```cython
cdef double price_momentum      # ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ
cdef double bb_squeeze          # ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ
cdef double trend_strength      # ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–¢–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã**

---

#### –§–æ—Ä–º—É–ª—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**1. Price Momentum (—Å—Ç—Ä–æ–∫–∞ 160):**
```cython
price_momentum = tanh(momentum / (price_d * 0.01 + 1e-8))
```
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ 1% —Ü–µ–Ω—ã
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å (+ 1e-8)
- ‚úÖ tanh –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ [-1, 1]

**2. Bollinger Bands Squeeze (—Å—Ç—Ä–æ–∫–∞ 168):**
```cython
bb_squeeze = tanh((bb_upper - bb_lower) / (price_d + 1e-8))
```
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª–Ω–æ–π —Ü–µ–Ω—ã
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
- ‚úÖ tanh –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞

**3. Trend Strength (—Å—Ç—Ä–æ–∫–∞ 175):**
```cython
trend_strength = tanh((macd - macd_signal) / (price_d * 0.01 + 1e-8))
```
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ 1% —Ü–µ–Ω—ã
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
- ‚úÖ tanh –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞

**feature_idx –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 161-162: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞
- ‚úÖ –†–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ `out_features` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–í—Å–µ —Ñ–æ—Ä–º—É–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã**

---

### ‚ùå mediator.py (_extract_norm_cols)

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –º–∞—Å—Å–∏–≤–∞ (—Å—Ç—Ä–æ–∫–∏ 1008-1050)

**–†–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞:**
```python
norm_cols = np.zeros(21, dtype=np.float32)  # ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ: 21 –ø—Ä–∏–∑–Ω–∞–∫
```

**–ú–∞–ø–ø–∏–Ω–≥ –∏–Ω–¥–µ–∫—Å–æ–≤:**

| –ò–Ω–¥–µ–∫—Å | –ü—Ä–∏–∑–Ω–∞–∫ | –§–∞–π–ª-–∏—Å—Ç–æ—á–Ω–∏–∫ | –°—Ç–∞—Ç—É—Å |
|--------|---------|---------------|--------|
| 0 | cvd_24h | transformers.py | ‚úÖ |
| 1 | cvd_7d | transformers.py | ‚úÖ |
| 2 | yang_zhang_48h | transformers.py | ‚úÖ |
| 3 | yang_zhang_7d | transformers.py | ‚úÖ |
| 4 | **garch_8d** | transformers.py | üî¥ **–ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï** |
| 5 | garch_14d | transformers.py | ‚úÖ |
| 6 | ret_12h | transformers.py | ‚úÖ |
| 7 | ret_24h | transformers.py | ‚úÖ |
| 8 | ret_4h | transformers.py | ‚úÖ |
| 9 | sma_50 | transformers.py | ‚úÖ |
| 10 | yang_zhang_30d | transformers.py | ‚úÖ |
| 11 | parkinson_48h | transformers.py | ‚úÖ |
| 12 | parkinson_7d | transformers.py | ‚úÖ |
| 13 | garch_30d | transformers.py | ‚úÖ |
| 14 | taker_buy_ratio | transformers.py | ‚úÖ |
| 15 | taker_buy_ratio_sma_24h | transformers.py | ‚úÖ |
| 16 | taker_buy_ratio_sma_8h | transformers.py | ‚úÖ |
| 17 | taker_buy_ratio_sma_16h | transformers.py | ‚úÖ |
| 18 | taker_buy_ratio_momentum_4h | transformers.py | ‚úÖ |
| 19 | taker_buy_ratio_momentum_8h | transformers.py | ‚úÖ |
| 20 | taker_buy_ratio_momentum_12h | transformers.py | ‚úÖ |

**üî¥ –ü–†–û–ë–õ–ï–ú–ê #2 (CRITICAL): –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞ GARCH**

**–§–∞–π–ª:** mediator.py:1025
**–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** transformers.py:664-666

**–û–ø–∏—Å–∞–Ω–∏–µ:**

**mediator.py –æ–∂–∏–¥–∞–µ—Ç:**
```python
norm_cols[4] = self._get_safe_float(row, "garch_8d", 0.0)  # ‚ùå garch_8d
```

**transformers.py –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:**
```python
# –û–∫–Ω–æ: 50 * 240 = 12000 –º–∏–Ω—É—Ç
window_name = _format_window_name(12000)  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç "200h" (–Ω–µ "8d"!)
feature_name = f"garch_{window_name}"     # –†–µ–∑—É–ª—å—Ç–∞—Ç: "garch_200h"
```

**–ü—Ä–∏—á–∏–Ω–∞:**

–§—É–Ω–∫—Ü–∏—è `_format_window_name` (transformers.py:40-42):
```python
if window_minutes >= 10080 and window_minutes % 1440 == 0:  # >= 7 –¥–Ω–µ–π –∏ –∫—Ä–∞—Ç–Ω–æ –¥–Ω—é
    return f"{window_minutes // 1440}d"
```

- 12000 –º–∏–Ω—É—Ç >= 10080 ‚úÖ
- 12000 % 1440 = 480 (–Ω–µ –∫—Ä–∞—Ç–Ω–æ –¥–Ω—é!) ‚ùå
- –ü–æ—ç—Ç–æ–º—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç —á–∞—Å–æ–≤: `12000 // 60 = 200h`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ü—Ä–∏–∑–Ω–∞–∫ `garch_8d` –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω –≤ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå `_get_safe_float(row, "garch_8d", 0.0)` –≤—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω–µ—Ç 0.0
- ‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è GARCH –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –æ–∫–Ω–∞
- ‚ùå –ü–æ—Ç–µ—Ä—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

**–í–∞—Ä–∏–∞–Ω—Ç 1 (–∏–∑–º–µ–Ω–∏—Ç—å –æ–∫–Ω–æ –≤ transformers.py):**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 11520 –º–∏–Ω—É—Ç (—Ä–æ–≤–Ω–æ 8 –¥–Ω–µ–π) –≤–º–µ—Å—Ç–æ 12000
# 8 * 24 * 60 = 11520 –º–∏–Ω—É—Ç = 48 –±–∞—Ä–æ–≤
self.garch_windows = [8 * 24 * 60, 14 * 24 * 60, 30 * 24 * 60]  # 11520, 20160, 43200
```

**–í–∞—Ä–∏–∞–Ω—Ç 2 (–∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –≤ mediator.py):**
```python
norm_cols[4] = self._get_safe_float(row, "garch_200h", 0.0)  # –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ garch_200h
```

**–í–∞—Ä–∏–∞–Ω—Ç 3 (–∏–∑–º–µ–Ω–∏—Ç—å _format_window_name –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–ª—É—á–∞—è GARCH):**
```python
# –í transformers.py –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è GARCH
# –ï—Å–ª–∏ 12000 –º–∏–Ω—É—Ç (8.33 –¥–Ω—è), –æ–∫—Ä—É–≥–ª–∏—Ç—å –¥–æ "8d" –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** **–í–∞—Ä–∏–∞–Ω—Ç 1** - –∏–∑–º–µ–Ω–∏—Ç—å –æ–∫–Ω–æ –Ω–∞ —Ä–æ–≤–Ω–æ 8 –¥–Ω–µ–π (11520 –º–∏–Ω—É—Ç = 48 –±–∞—Ä–æ–≤), —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–Ω–∏–º—É–º 48 > 50... –Ω–µ—Ç, —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç.–∫. –º–∏–Ω–∏–º—É–º 50 –±–∞—Ä–æ–≤ –¥–ª—è GARCH!

**–õ—É—á—à–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** **–í–∞—Ä–∏–∞–Ω—Ç 2** - –∏–∑–º–µ–Ω–∏—Ç—å mediator.py –Ω–∞ `garch_200h`, —Ç.–∫. 50 –±–∞—Ä–æ–≤ - —ç—Ç–æ –º–∏–Ω–∏–º—É–º –¥–ª—è GARCH, –∏ 12000 –º–∏–Ω—É—Ç = 200 —á–∞—Å–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** CRITICAL - –ø—Ä–∏–∑–Ω–∞–∫ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–æ–¥–µ–ª–∏

**–í–µ—Ä–¥–∏–∫—Ç:** üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê - —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

---

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ NaN –∑–Ω–∞—á–µ–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
def _get_safe_float(row: Any, col: str, default: float = 0.0) -> float:
    # –°—Ç—Ä–æ–∫–∞ 915-928
    if row is None:
        return default
    try:
        val = row.get(col) if hasattr(row, "get") else getattr(row, col, None)
        if val is None:
            return default
        result = float(val)
        if not math.isfinite(result):  # ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ NaN –∏ infinity
            return default
        return result
    except (TypeError, ValueError, KeyError, AttributeError):
        return default
```

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ NaN –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞**

---

## 2. –õ–û–ì–ò–ß–ï–°–ö–ê–Ø –ö–û–†–†–ï–ö–¢–ù–û–°–¢–¨ –§–û–†–ú–£–õ

### Yang-Zhang –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

**–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞:**
```
œÉ¬≤_YZ = œÉ¬≤_o + k¬∑œÉ¬≤_c + (1-k)¬∑œÉ¬≤_rs

–≥–¥–µ:
- œÉ¬≤_o = –Ω–æ—á–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å = (1/(n-1)) Œ£(log(O_i/C_{i-1}) - Œº_o)¬≤
- œÉ¬≤_c = –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å open-close = (1/(n-1)) Œ£(log(C_i/O_i) - Œº_c)¬≤
- œÉ¬≤_rs = –†–æ–¥–∂–µ—Ä—Å-–°–∞—Ç—á–µ–ª–ª = (1/n) Œ£[log(H_i/C_i)¬∑log(H_i/O_i) + log(L_i/C_i)¬∑log(L_i/O_i)]
- k = 0.34 (—ç–º–ø–∏—Ä–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å)
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ k = 0.34 (—Å—Ç—Ä–æ–∫–∞ 76)
- ‚úÖ œÉ¬≤_o: –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ (n-1) –¥–ª—è –Ω–µ—Å–º–µ—â–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –¥–∏—Å–ø–µ—Ä—Å–∏–∏
- ‚úÖ œÉ¬≤_c: –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ (n-1) –¥–ª—è –Ω–µ—Å–º–µ—â–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –¥–∏—Å–ø–µ—Ä—Å–∏–∏
- ‚úÖ œÉ¬≤_rs: –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ n (–≤–∞–ª–∏–¥–Ω—ã—Ö –±–∞—Ä–æ–≤)
- ‚úÖ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è: œÉ¬≤_o + k¬∑œÉ¬≤_c + (1-k)¬∑œÉ¬≤_rs

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–§–æ—Ä–º—É–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

### Parkinson –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

**–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞:**
```
œÉ¬≤ = (1/(4n¬∑ln(2))) ¬∑ Œ£(ln(H_i/L_i))¬≤
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
parkinson_var = sum_sq / (4 * valid_bars * math.log(2))
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞:**
- ‚úÖ 4¬∑ln(2) ‚âà 2.772 –≤ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç valid_bars –≤–º–µ—Å—Ç–æ n (—É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–§–æ—Ä–º—É–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

### GARCH(1,1) –º–æ–¥–µ–ª—å

**–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å:**
```
r_t = Œº + Œµ_t
Œµ_t = œÉ_t * z_t, –≥–¥–µ z_t ~ N(0,1)
œÉ¬≤_t = œâ + Œ±*Œµ¬≤_{t-1} + Œ≤*œÉ¬≤_{t-1}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ p=1, q=1 (GARCH –ø–æ—Ä—è–¥–æ–∫ –∏ ARCH –ø–æ—Ä—è–¥–æ–∫)
- ‚úÖ rescale=False (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞)
- ‚úÖ dist='normal' (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫)
- ‚úÖ horizon=1 (–ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 1 —à–∞–≥ –≤–ø–µ—Ä–µ–¥)

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–ú–æ–¥–µ–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

---

### CVD (Cumulative Volume Delta)

**–§–æ—Ä–º—É–ª–∞:**
```python
volume_delta = taker_buy_base - (volume - taker_buy_base)
             = 2 * taker_buy_base - volume
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ï—Å–ª–∏ –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ (taker_buy_base = volume):
  - volume_delta = 2¬∑volume - volume = volume ‚úÖ
- –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–¥–∞–∂–∏ (taker_buy_base = 0):
  - volume_delta = 0 - volume = -volume ‚úÖ
- –ï—Å–ª–∏ 50/50 (taker_buy_base = volume/2):
  - volume_delta = 2¬∑(volume/2) - volume = 0 ‚úÖ

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–§–æ—Ä–º—É–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞**

---

### Taker Buy Ratio

**–§–æ—Ä–º—É–ª–∞:**
```python
taker_buy_ratio = min(1.0, max(0.0, taker_buy_base / volume))
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 1]
- ‚úÖ Clamping –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (taker_buy_base > volume)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å (–ø—Ä–æ–≤–µ—Ä–∫–∞ volume > 0 –≤ —Å—Ç—Ä–æ–∫–µ 572)

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–§–æ—Ä–º—É–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞**

---

### Taker Buy Ratio Momentum

**–§–æ—Ä–º—É–ª–∞:**
```python
momentum = current - past
–≥–¥–µ past = ratio_list[-(window + 1)]
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
- –î–ª—è window=1: past = ratio_list[-2] (–∑–Ω–∞—á–µ–Ω–∏–µ 1 –ø–µ—Ä–∏–æ–¥ –Ω–∞–∑–∞–¥) ‚úÖ
- –î–ª—è window=3: past = ratio_list[-4] (–∑–Ω–∞—á–µ–Ω–∏–µ 3 –ø–µ—Ä–∏–æ–¥–∞ –Ω–∞–∑–∞–¥) ‚úÖ
- –£—Å–ª–æ–≤–∏–µ: `len(ratio_list) >= window + 1` ‚úÖ

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞**

---

## 3. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í PIPELINE

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

**–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –∏–º–µ–Ω–∞ (transformers.py):**

| –¢–∏–ø | –û–∫–Ω–æ (–º–∏–Ω—É—Ç—ã) | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–µ –∏–º—è | –û–∂–∏–¥–∞–µ—Ç—Å—è –≤ mediator.py | –°—Ç–∞—Ç—É—Å |
|-----|---------------|------------------|------------------------|--------|
| ret | 240 | ret_4h | ret_4h | ‚úÖ |
| ret | 720 | ret_12h | ret_12h | ‚úÖ |
| ret | 1440 | ret_24h | ret_24h | ‚úÖ |
| yang_zhang | 2880 | yang_zhang_48h | yang_zhang_48h | ‚úÖ |
| yang_zhang | 10080 | yang_zhang_7d | yang_zhang_7d | ‚úÖ |
| yang_zhang | 43200 | yang_zhang_30d | yang_zhang_30d | ‚úÖ |
| parkinson | 2880 | parkinson_48h | parkinson_48h | ‚úÖ |
| parkinson | 10080 | parkinson_7d | parkinson_7d | ‚úÖ |
| **garch** | **12000** | **garch_200h** | **garch_8d** | üî¥ **–ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï** |
| garch | 20160 | garch_14d | garch_14d | ‚úÖ |
| garch | 43200 | garch_30d | garch_30d | ‚úÖ |
| cvd | 1440 | cvd_24h | cvd_24h | ‚úÖ |
| cvd | 10080 | cvd_7d | cvd_7d | ‚úÖ |
| taker_buy_ratio_sma | 480 | taker_buy_ratio_sma_8h | taker_buy_ratio_sma_8h | ‚úÖ |
| taker_buy_ratio_sma | 960 | taker_buy_ratio_sma_16h | taker_buy_ratio_sma_16h | ‚úÖ |
| taker_buy_ratio_sma | 1440 | taker_buy_ratio_sma_24h | taker_buy_ratio_sma_24h | ‚úÖ |
| taker_buy_ratio_momentum | 240 | taker_buy_ratio_momentum_4h | taker_buy_ratio_momentum_4h | ‚úÖ |
| taker_buy_ratio_momentum | 480 | taker_buy_ratio_momentum_8h | taker_buy_ratio_momentum_8h | ‚úÖ |
| taker_buy_ratio_momentum | 720 | taker_buy_ratio_momentum_12h | taker_buy_ratio_momentum_12h | ‚úÖ |

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ùå **–ù–∞–π–¥–µ–Ω–æ 1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ (garch_8d vs garch_200h)**

---

## 4. –ì–†–ê–ù–ò–ß–ù–´–ï –°–õ–£–ß–ê–ò

### –ó–∞—â–∏—Ç–∞ –æ—Ç division by zero

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:**

1. ‚úÖ Yang-Zhang: `prev_close > 0` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ `log(curr_open / prev_close)`
2. ‚úÖ Yang-Zhang: `open_price > 0` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ `log(close_price / open_price)`
3. ‚úÖ Parkinson: `high > 0 and low > 0` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ `log(high / low)`
4. ‚úÖ Taker Buy Ratio: `volume > 0` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –¥–µ–ª–µ–Ω–∏–µ–º
5. ‚úÖ obs_builder.pyx: –≤—Å–µ –¥–µ–ª–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã `+ 1e-8`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–í—Å–µ –¥–µ–ª–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã**

---

### –ó–∞—â–∏—Ç–∞ –æ—Ç log(0) –∏ sqrt(negative)

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:**

1. ‚úÖ Yang-Zhang: –ø—Ä–æ–≤–µ—Ä–∫–∞ `price > 0` –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ `log()`
2. ‚úÖ Yang-Zhang: –ø—Ä–æ–≤–µ—Ä–∫–∞ `sigma_yz_sq < 0` –ø–µ—Ä–µ–¥ `sqrt()`
3. ‚úÖ Parkinson: –ø—Ä–æ–≤–µ—Ä–∫–∞ `high > 0 and low > 0` –ø–µ—Ä–µ–¥ `log(high/low)`
4. ‚úÖ GARCH: –ø—Ä–æ–≤–µ—Ä–∫–∞ `price_window <= 0` –ø–µ—Ä–µ–¥ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–í—Å–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã**

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–æ–Ω

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

1. ‚úÖ Yang-Zhang: —Ç—Ä–µ–±—É–µ—Ç `n >= 2` –∏ –º–∏–Ω–∏–º—É–º 2 –≤–∞–ª–∏–¥–Ω—ã—Ö overnight/oc returns
2. ‚úÖ Parkinson: —Ç—Ä–µ–±—É–µ—Ç `n >= 2` –∏ –º–∏–Ω–∏–º—É–º 80% –≤–∞–ª–∏–¥–Ω—ã—Ö –±–∞—Ä–æ–≤
3. ‚úÖ GARCH: —Ç—Ä–µ–±—É–µ—Ç `n >= 50` –Ω–∞–±–ª—é–¥–µ–Ω–∏–π
4. ‚úÖ Taker Buy Ratio Momentum: —Ç—Ä–µ–±—É–µ—Ç `len >= window + 1`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–í—Å–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –æ–∫–æ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è**

---

### –û–±—Ä–∞–±–æ—Ç–∫–∞ NaN –∏ Infinity

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:**

1. ‚úÖ GARCH: `np.any(~np.isfinite(price_window))` - –ø—Ä–æ–≤–µ—Ä–∫–∞ NaN/Inf
2. ‚úÖ GARCH: `np.isfinite(forecast_variance)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
3. ‚úÖ mediator.py: `math.isfinite(result)` –≤ `_get_safe_float()`
4. ‚úÖ obs_builder.pyx: `isnan()` –¥–ª—è ma5, ma20, bb_lower, bb_upper

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **NaN –∏ Infinity –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è**

---

## 5. –°–û–ì–õ–ê–°–û–í–ê–ù–ù–û–°–¢–¨ –ü–ê–†–ê–ú–ï–¢–†–û–í

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

| –ü–∞—Ä–∞–º–µ—Ç—Ä | transformers.py (—Å—Ç—Ä–æ–∫–∞ 326-449) | make_features.py (—Å—Ç—Ä–æ–∫–∞ 24-36) | –°—Ç–∞—Ç—É—Å |
|----------|----------------------------------|----------------------------------|--------|
| lookbacks_prices | [240, 720, 1440, 12000] | "240,720,1440,12000" | ‚úÖ |
| yang_zhang_windows | [2880, 10080, 43200] | "2880,10080,43200" | ‚úÖ |
| parkinson_windows | [2880, 10080] | "2880,10080" | ‚úÖ |
| garch_windows | [12000, 20160, 43200] | "12000,20160,43200" | ‚úÖ |
| taker_buy_ratio_windows | [480, 960, 1440] | "480,960,1440" | ‚úÖ |
| taker_buy_ratio_momentum | [240, 480, 720] | "240,480,720" | ‚úÖ |
| cvd_windows | [1440, 10080] | "1440,10080" | ‚úÖ |
| bar_duration_minutes | 240 | 240 | ‚úÖ |
| rsi_period | 14 | 14 | ‚úÖ |

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏**

---

## 6. –¢–ò–ü–´ –î–ê–ù–ù–´–•

### –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤

**transformers.py:**
- ‚úÖ float –¥–ª—è —Ü–µ–Ω –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ int –¥–ª—è —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–æ–Ω
- ‚úÖ List[int] –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ –æ–∫–æ–Ω
- ‚úÖ deque –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ Optional[float] –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

**obs_builder.pyx:**
- ‚úÖ float –∏ double –¥–ª—è –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —á–∏—Å–µ–ª
- ‚úÖ int –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ —Å—á–µ—Ç—á–∏–∫–æ–≤
- ‚úÖ float[::1] –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤ C-–ø–æ—Ä—è–¥–∫–∞

**mediator.py:**
- ‚úÖ float –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- ‚úÖ np.float32 –¥–ª—è –º–∞—Å—Å–∏–≤–∞ norm_cols
- ‚úÖ Dict[str, float] –¥–ª—è —Å–ª–æ–≤–∞—Ä–µ–π –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã**

---

## 7. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. ‚úÖ **deque —Å maxlen** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫–æ–ª—å–∑—è—â–∏—Ö –æ–∫–æ–Ω
2. ‚úÖ **numpy –º–∞—Å—Å–∏–≤—ã** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (GARCH)
3. ‚úÖ **list() –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã, —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
4. ‚úÖ **try-except** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –Ω–µ –≤ –≥–æ—Ä—è—á–∏—Ö —Ü–∏–∫–ª–∞—Ö

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–ü—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ**

---

## 8. –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ docstring —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**Yang-Zhang:**
- ‚úÖ –§–æ—Ä–º—É–ª–∞ –≤ docstring —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ

**Parkinson:**
- ‚úÖ –§–æ—Ä–º—É–ª–∞ –≤ docstring —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 4¬∑ln(2) —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ

**GARCH:**
- ‚úÖ –ú–æ–¥–µ–ª—å –æ–ø–∏—Å–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ö†Ô∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–æ –æ–∫–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—å (—Å–º. –ü–†–û–ë–õ–ï–ú–ê #1)

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–ª—è GARCH**

---

## –ò–¢–û–ì–û–í–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

**1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞ GARCH (–ü–†–û–ë–õ–ï–ú–ê #2)**

**–§–∞–π–ª:** mediator.py:1025
**–î–µ–π—Å—Ç–≤–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç—å

**–î–æ:**
```python
norm_cols[4] = self._get_safe_float(row, "garch_8d", 0.0)
```

**–ü–æ—Å–ª–µ:**
```python
norm_cols[4] = self._get_safe_float(row, "garch_200h", 0.0)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- transformers.py –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–º—è `garch_200h` –¥–ª—è –æ–∫–Ω–∞ 12000 –º–∏–Ω—É—Ç
- 12000 –º–∏–Ω—É—Ç –Ω–µ –∫—Ä–∞—Ç–Ω–æ –¥–Ω—é (12000 % 1440 = 480), –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç —á–∞—Å–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –≤ mediator.py –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∞

---

### üü° –í–ê–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å)

**1. –ù–µ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö GARCH (–ü–†–û–ë–õ–ï–ú–ê #1)**

**–§–∞–π–ª:** transformers.py:445-447
**–î–µ–π—Å—Ç–≤–∏–µ:** –£—Ç–æ—á–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

**–î–æ:**
```python
# 8d = 50 –±–∞—Ä–æ–≤ = 12000 –º–∏–Ω—É—Ç (–º–∏–Ω–∏–º—É–º –¥–ª—è GARCH)
```

**–ü–æ—Å–ª–µ:**
```python
# 50 –±–∞—Ä–æ–≤ (8.33d) = 12000 –º–∏–Ω—É—Ç = 200h (–º–∏–Ω–∏–º—É–º –¥–ª—è GARCH)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- 12000 –º–∏–Ω—É—Ç = 8.33 –¥–Ω—è (–Ω–µ —Ä–æ–≤–Ω–æ 8 –¥–Ω–µ–π)
- –£—Ç–æ—á–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –ø—É—Ç–∞–Ω–∏—Ü—É

---

## –í–´–í–û–î–´

### –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
1. ‚úÖ –§–æ—Ä–º—É–ª—ã –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–µ–æ—Ä–∏–∏
2. ‚úÖ –í—Å–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (division by zero, NaN, Infinity)
3. ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏
4. ‚úÖ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã
5. ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞
6. ‚úÖ 20 –∏–∑ 21 –ø—Ä–∏–∑–Ω–∞–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. üî¥ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞ `garch_8d` vs `garch_200h` –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –≤ –º–æ–¥–µ–ª–∏

**–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**
1. üü° –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è GARCH —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –æ–∫–æ–Ω

---

## –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É —Å –∏–º–µ–Ω–µ–º GARCH

```bash
# –ò–∑–º–µ–Ω–∏—Ç—å mediator.py:1025
sed -i 's/garch_8d/garch_200h/g' mediator.py
```

### –®–∞–≥ 2: –£—Ç–æ—á–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ transformers.py

```bash
# –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É 445
# –°: "8d = 50 –±–∞—Ä–æ–≤ = 12000 –º–∏–Ω—É—Ç"
# –ù–∞: "50 –±–∞—Ä–æ–≤ (8.33d) = 12000 –º–∏–Ω—É—Ç = 200h"
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
python test_feature_names.py
python test_4h_integration_fixes.py
```

---

## –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `garch_200h` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ 21 –ø—Ä–∏–∑–Ω–∞–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ norm_cols
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π pipeline –∏ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ NaN –≤ GARCH –ø—Ä–∏–∑–Ω–∞–∫–µ
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ missing features

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 11 –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è 4h –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ **–Ω–∞ 95% –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ **1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞** —Å –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∞ GARCH, –∫–æ—Ç–æ—Ä–∞—è —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞**.

**–í—Å–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**, –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã.

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—É–¥–∏—Ç–∞:** 2025-11-12
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ê–£–î–ò–¢ –ó–ê–í–ï–†–®–ï–ù**
**–¢—Ä–µ–±—É–µ—Ç—Å—è:** üî¥ **1 –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï**
