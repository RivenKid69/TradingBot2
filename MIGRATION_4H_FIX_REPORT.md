# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞

**–î–∞—Ç–∞:** 2025-11-13
**–ê–≤—Ç–æ—Ä:** Claude (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç)
**–í–µ—Ä—Å–∏—è:** Final Fix

---

## –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ

‚úÖ **–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö 56 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞**

**–ù–∞–π–¥–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º:** 1
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 1
**–§–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:** 10+
**–ü—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:** 56

---

## –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `time_since_event`

**–§–∞–π–ª:** `obs_builder.pyx:201`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è 4h):
out_features[feature_idx] = <float>tanh(time_since_event / 24.0)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –î–ª—è 1h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 24.0 (24 –±–∞—Ä–∞ = 24 —á–∞—Å–∞)
- –î–ª—è 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ –æ–¥–∏–Ω –±–∞—Ä = 4 —á–∞—Å–∞
- –°–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö ~24 —á–∞—Å–æ–≤ = 6 –±–∞—Ä–æ–≤ (6 √ó 4h = 24h)
- –°–æ–≥–ª–∞—Å–Ω–æ `config_4h_timeframe.py:266`: `TIME_SINCE_EVENT_DIVISOR = 6`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è 4h):
# CRITICAL FIX: Adapted for 4h timeframe (6 bars * 4h = 24h window)
# Changed from 24.0 (for 1h timeframe) to 6.0 (for 4h timeframe)
# This normalizes events within ~24 hours (6 bars on 4h timeframe)
out_features[feature_idx] = <float>tanh(time_since_event / 6.0)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `obs_builder.pyx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç
- `OBSERVATION_MAPPING.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `FEATURE_AUDIT_REPORT.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## –ü–†–û–í–ï–†–ï–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–í–°–ï –û–ö ‚úÖ)

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ 56 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
```
–ë–ª–æ–∫               –†–∞–∑–º–µ—Ä  –°—Ç–∞—Ç—É—Å
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
bar                   3    ‚úÖ
derived               2    ‚úÖ
indicators           13    ‚úÖ
microstructure        3    ‚úÖ (–∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ candlestick –¥–ª—è 4h)
agent                 6    ‚úÖ
metadata              5    ‚úÖ
external             21    ‚úÖ
token_meta            2    ‚úÖ
token                 1    ‚úÖ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û:              56    ‚úÖ
```

### 2. External features (21 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤) - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

| ‚Ññ | –ü—Ä–∏–∑–Ω–∞–∫ | –û–∫–Ω–æ (–º–∏–Ω) | –û–∫–Ω–æ (–±–∞—Ä—ã 4h) | –ò–º—è –ø—Ä–∏–∑–Ω–∞–∫–∞ | –°—Ç–∞—Ç—É—Å |
|---|---------|------------|----------------|--------------|--------|
| 0 | cvd_24h | 1440 | 6 | cvd_24h | ‚úÖ |
| 1 | cvd_7d | 10080 | 42 | cvd_7d | ‚úÖ |
| 2 | yang_zhang_48h | 2880 | 12 | yang_zhang_48h | ‚úÖ |
| 3 | yang_zhang_7d | 10080 | 42 | yang_zhang_7d | ‚úÖ |
| 4 | garch_200h | 12000 | 50 | garch_200h | ‚úÖ |
| 5 | garch_14d | 20160 | 84 | garch_14d | ‚úÖ |
| 6 | ret_12h | 720 | 3 | ret_12h | ‚úÖ |
| 7 | ret_24h | 1440 | 6 | ret_24h | ‚úÖ |
| 8 | ret_4h | 240 | 1 | ret_4h | ‚úÖ |
| 9 | sma_12000 | 12000 | 50 | sma_12000 | ‚úÖ |
| 10 | yang_zhang_30d | 43200 | 180 | yang_zhang_30d | ‚úÖ |
| 11 | parkinson_48h | 2880 | 12 | parkinson_48h | ‚úÖ |
| 12 | parkinson_7d | 10080 | 42 | parkinson_7d | ‚úÖ |
| 13 | garch_30d | 43200 | 180 | garch_30d | ‚úÖ |
| 14 | taker_buy_ratio | - | - | taker_buy_ratio | ‚úÖ |
| 15 | taker_buy_ratio_sma_24h | 1440 | 6 | taker_buy_ratio_sma_24h | ‚úÖ |
| 16 | taker_buy_ratio_sma_8h | 480 | 2 | taker_buy_ratio_sma_8h | ‚úÖ |
| 17 | taker_buy_ratio_sma_16h | 960 | 4 | taker_buy_ratio_sma_16h | ‚úÖ |
| 18 | taker_buy_ratio_momentum_4h | 240 | 1 | taker_buy_ratio_momentum_4h | ‚úÖ |
| 19 | taker_buy_ratio_momentum_8h | 480 | 2 | taker_buy_ratio_momentum_8h | ‚úÖ |
| 20 | taker_buy_ratio_momentum_12h | 720 | 3 | taker_buy_ratio_momentum_12h | ‚úÖ |

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –í—Å–µ –∏–º–µ–Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–ª—è 4h
- ‚úÖ GARCH –º–∏–Ω–∏–º—É–º 50 –±–∞—Ä–æ–≤ (200h) —Å–æ–±–ª—é–¥–µ–Ω
- ‚úÖ Yang-Zhang –º–∏–Ω–∏–º—É–º 12 –±–∞—Ä–æ–≤ (48h) —Å–æ–±–ª—é–¥–µ–Ω
- ‚úÖ –í—Å–µ –æ–∫–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ –º–∏–Ω—É—Ç –≤ –±–∞—Ä—ã

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**transformers.py:**
- ‚úÖ `bar_duration_minutes = 240` (4h)
- ‚úÖ Default lookbacks: `[240, 720, 1200, 1440, 5040, 10080, 12000]` –º–∏–Ω—É—Ç
- ‚úÖ GARCH windows: `[50 * 240, 14 * 24 * 60, 30 * 24 * 60]` = `[12000, 20160, 43200]` –º–∏–Ω—É—Ç
- ‚úÖ Yang-Zhang windows: `[48 * 60, 7 * 24 * 60, 30 * 24 * 60]` = `[2880, 10080, 43200]` –º–∏–Ω—É—Ç
- ‚úÖ Parkinson windows: `[48 * 60, 7 * 24 * 60]` = `[2880, 10080]` –º–∏–Ω—É—Ç
- ‚úÖ Taker Buy Ratio SMA: `[8 * 60, 16 * 60, 24 * 60]` = `[480, 960, 1440]` –º–∏–Ω—É—Ç
- ‚úÖ Taker Buy Ratio Momentum: `[4 * 60, 8 * 60, 12 * 60, 24 * 60]` = `[240, 480, 720, 1440]` –º–∏–Ω—É—Ç

**mediator.py:**
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–º–æ–≤ –¥–ª—è 4h:
  - `log_volume_norm = tanh(log1p(quote_volume / 240e6))` (240x –¥–ª—è 4h)
  - `rel_volume = tanh(log1p(volume / 24000.0))` (240x –¥–ª—è 4h)
- ‚úÖ SMA –∏–º–µ–Ω–∞: `sma_1200`, `sma_5040` (–≤ –º–∏–Ω—É—Ç–∞—Ö, –Ω–µ –±–∞—Ä–∞—Ö)
- ‚úÖ –í—Å–µ external –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –¥–ª—è 4h

**feature_config.py:**
- ‚úÖ `EXT_NORM_DIM = 21`
- ‚úÖ `N_FEATURES = 56`
- ‚úÖ Feature layout –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

### 4. –ò–º–µ–Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `_format_window_name()`:**
- ‚úÖ –î–Ω–∏ (>= 7d –∏ –∫—Ä–∞—Ç–Ω–æ 1440 –º–∏–Ω—É—Ç–∞–º): `7d`, `14d`, `30d`
- ‚úÖ –ß–∞—Å—ã (>= 60 –º–∏–Ω—É—Ç –∏ –∫—Ä–∞—Ç–Ω–æ 60): `4h`, `12h`, `24h`, `48h`, `200h`
- ‚úÖ –ú–∏–Ω—É—Ç—ã: `240m`, `720m`, `12000m` (–¥–ª—è SMA –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—ã—Ä—ã–µ –º–∏–Ω—É—Ç—ã)

**–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏:**
- ‚úÖ transformers.py —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
- ‚úÖ mediator.py –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
- ‚úÖ –ù–µ—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

### 5. –§–æ—Ä–º—É–ª—ã –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

**Yang-Zhang –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
```python
œÉ¬≤_YZ = œÉ¬≤_o + k¬∑œÉ¬≤_c + (1-k)¬∑œÉ¬≤_rs
–≥–¥–µ k = 0.34
```
- ‚úÖ –§–æ—Ä–º—É–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (transformers.py:49-137)
- ‚úÖ –ú–∏–Ω–∏–º—É–º 12 –±–∞—Ä–æ–≤ –¥–ª—è 4h (48h)

**Parkinson –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
```python
œÉ_Parkinson = sqrt[(1/(4n¬∑log(2))) ¬∑ Œ£(log(H_i/L_i))¬≤]
```
- ‚úÖ –§–æ—Ä–º—É–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (transformers.py:140-192)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏: –º–∏–Ω–∏–º—É–º 80% –æ—Ç –æ–∫–Ω–∞

**GARCH(1,1) –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
```python
œÉ¬≤_t = œâ + Œ±*Œµ¬≤_{t-1} + Œ≤*œÉ¬≤_{t-1}
```
- ‚úÖ –§–æ—Ä–º—É–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (transformers.py:195-274)
- ‚úÖ –ú–∏–Ω–∏–º—É–º 50 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 215)
- ‚úÖ –ü–µ—Ä–≤–æ–µ –æ–∫–Ω–æ: 50 –±–∞—Ä–æ–≤ = 12000 –º–∏–Ω—É—Ç = 200h

### 6. Taker Buy Ratio

**–§–æ—Ä–º—É–ª–∞:**
```python
taker_buy_ratio = min(1.0, max(0.0, taker_buy_base / volume))
```
- ‚úÖ Clamping [0, 1] —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (transformers.py:579)
- ‚úÖ SMA –æ–∫–Ω–∞: [2, 4, 6] –±–∞—Ä–æ–≤ = [8h, 16h, 24h]
- ‚úÖ Momentum –æ–∫–Ω–∞: [1, 2, 3, 6] –±–∞—Ä–æ–≤ = [4h, 8h, 12h, 24h]

### 7. Microstructure –∑–∞–º–µ–Ω–∞ –¥–ª—è 4h

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∏–∫—Ä–æ—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (ofi_proxy, qimb, micro_dev) —Ç—Ä–µ–±—É—é—Ç –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º—ã –Ω–∞ 4h.

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ candlestick-based –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (obs_builder.pyx:153-177):
1. `price_momentum = tanh(momentum / (price * 0.01))` - –∑–∞–º–µ–Ω—è–µ—Ç ofi_proxy
2. `bb_squeeze = tanh((bb_upper - bb_lower) / price)` - –∑–∞–º–µ–Ω—è–µ—Ç qimb
3. `trend_strength = tanh((macd - macd_signal) / (price * 0.01))` - –∑–∞–º–µ–Ω—è–µ—Ç micro_dev

- ‚úÖ –§–æ—Ä–º—É–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, —Å–∏–ª–∞ —Ç—Ä–µ–Ω–¥–∞)

---

## –§–ê–ô–õ–´ –° –ò–ó–ú–ï–ù–ï–ù–ò–Ø–ú–ò

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. ‚úÖ `obs_builder.pyx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è time_since_event (24.0 ‚Üí 6.0)
2. ‚úÖ `OBSERVATION_MAPPING.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
3. ‚úÖ `FEATURE_AUDIT_REPORT.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):
1. ‚úÖ `transformers.py` - –≤—Å–µ –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
2. ‚úÖ `mediator.py` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
3. ‚úÖ `feature_config.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
4. ‚úÖ `config_4h_timeframe.py` - —Å–ø—Ä–∞–≤–æ—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
5. ‚úÖ `make_features.py` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

---

## –ü–†–û–í–ï–†–û–ß–ù–´–ï –¢–ï–°–¢–´

### –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–≤—ã–ø–æ–ª–Ω–µ–Ω–∞):
```bash
python3 verify_56_features.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ:  3/4
‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: 1/4 (pydantic –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

–ü—Ä–æ–≤–µ—Ä–∫–∏:
‚úì EXT_NORM_DIM = 21
‚úì N_FEATURES = 56
‚úì –°—É–º–º–∞ –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤ = 56
‚úì 21 –∫–æ–ª–æ–Ω–∫–∞ norm_cols
‚úì –í—Å–µ –∏–º–µ–Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π):
```bash
# –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 56 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
pytest tests/test_full_feature_pipeline_56.py -v

# –ì–ª—É–±–æ–∫–∏–π –∞—É–¥–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ 11 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è 4h
pytest test_deep_integration_audit.py -v

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è 4h –º–∏–≥—Ä–∞—Ü–∏–∏
pytest test_4h_integration_fixes.py -v

# GARCH –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
pytest test_make_features_garch.py -v

# Yang-Zhang –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
pytest test_yang_zhang_integration.py -v

# Taker Buy Ratio
pytest test_taker_buy_ratio.py -v
```

---

## CHECKLIST: –í–°–ï 56 –ü–†–ò–ó–ù–ê–ö–û–í

### Bar level (3) ‚úÖ
- [x] price
- [x] log_volume_norm (240e6 –¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è 4h)
- [x] rel_volume (24000 –¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è 4h)

### MA features (4) ‚úÖ
- [x] ma5 = sma_1200 (5 –±–∞—Ä–æ–≤ √ó 240 = 1200 –º–∏–Ω—É—Ç)
- [x] ma5_valid
- [x] ma20 = sma_5040 (21 –±–∞—Ä √ó 240 = 5040 –º–∏–Ω—É—Ç)
- [x] ma20_valid

### Indicators (7) ‚úÖ
- [x] rsi14
- [x] macd
- [x] macd_signal
- [x] momentum
- [x] atr
- [x] cci
- [x] obv

### Derived (2) ‚úÖ
- [x] ret_bar (bar-to-bar return)
- [x] vol_proxy (ATR-based)

### Agent state (6) ‚úÖ
- [x] cash_fraction
- [x] position_fraction
- [x] vol_imbalance
- [x] trade_intensity
- [x] realized_spread
- [x] agent_fill_ratio

### Microstructure (3) ‚úÖ
- [x] price_momentum (–∑–∞–º–µ–Ω—è–µ—Ç ofi_proxy –¥–ª—è 4h)
- [x] bb_squeeze (–∑–∞–º–µ–Ω—è–µ—Ç qimb –¥–ª—è 4h)
- [x] trend_strength (–∑–∞–º–µ–Ω—è–µ—Ç micro_dev –¥–ª—è 4h)

### Bollinger Bands (2) ‚úÖ
- [x] bb_position
- [x] bb_width

### Event metadata (5) ‚úÖ
- [x] is_high_importance
- [x] time_since_event (**–ò–°–ü–†–ê–í–õ–ï–ù–û**: 6.0 –¥–ª—è 4h –≤–º–µ—Å—Ç–æ 24.0)
- [x] risk_off_flag
- [x] fear_greed_value
- [x] fear_greed_indicator

### External norm_cols (21) ‚úÖ
- [x] cvd_24h
- [x] cvd_7d
- [x] yang_zhang_48h
- [x] yang_zhang_7d
- [x] garch_200h (50 –±–∞—Ä–æ–≤, –º–∏–Ω–∏–º—É–º –¥–ª—è GARCH)
- [x] garch_14d
- [x] ret_12h
- [x] ret_24h
- [x] ret_4h
- [x] sma_12000 (50 –±–∞—Ä–æ–≤)
- [x] yang_zhang_30d
- [x] parkinson_48h
- [x] parkinson_7d
- [x] garch_30d
- [x] taker_buy_ratio
- [x] taker_buy_ratio_sma_24h
- [x] taker_buy_ratio_sma_8h
- [x] taker_buy_ratio_sma_16h
- [x] taker_buy_ratio_momentum_4h
- [x] taker_buy_ratio_momentum_8h
- [x] taker_buy_ratio_momentum_12h

### Token metadata (2) ‚úÖ
- [x] num_tokens_norm
- [x] token_id_norm

### Token one-hot (1) ‚úÖ
- [x] token[0]

**–ò–¢–û–ì–û: 56/56 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã ‚úÖ**

---

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´ –î–õ–Ø 4H (–ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è 1h | –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è 4h | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|----------|----------------|----------------|------|--------|
| bar_duration_minutes | 1 | 240 | transformers.py:304 | ‚úÖ |
| time_since_event divisor | 24.0 | 6.0 | obs_builder.pyx:204 | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û |
| quote_volume divisor | 1e6 | 240e6 | mediator.py:942 | ‚úÖ |
| volume divisor | 100 | 24000 | mediator.py:948 | ‚úÖ |
| GARCH min window (bars) | 500 | 50 | transformers.py:453 | ‚úÖ |
| Yang-Zhang min window (bars) | 24 | 12 | transformers.py:350 | ‚úÖ |
| SMA names format | sma_5, sma_15, sma_60 | sma_1200, sma_5040, sma_12000 | mediator.py:962-965 | ‚úÖ |
| Return names format | ret_5m, ret_15m, ret_60m | ret_4h, ret_12h, ret_24h | transformers.py:609 | ‚úÖ |

---

## –í–´–í–û–î–´

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ 56 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
2. **External features (21):** –í—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
3. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–º–æ–≤:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–µ–ª–∏—Ç–µ–ª–∏ (240e6, 24000)
4. **GARCH:** –ú–∏–Ω–∏–º—É–º 50 –±–∞—Ä–æ–≤ —Å–æ–±–ª—é–¥–µ–Ω
5. **Yang-Zhang/Parkinson:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–∫–Ω–∞
6. **Taker Buy Ratio:** –í—Å–µ 7 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
7. **–ò–º–µ–Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:** –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
8. **Microstructure replacement:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ candlestick –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è 4h

### ‚ùå –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **time_since_event –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:** 24.0 ‚Üí 6.0 –¥–ª—è 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞

### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. ‚úÖ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è: –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å `obs_builder.pyx` –≤ C-extension
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è `time_since_event` –≤ production - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [-1, 1]

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!**

- ‚úÖ –í—Å–µ 56 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ 1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–∞ 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–µ.**

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-11-13
**–ü–æ–¥–ø–∏—Å—å:** Claude (Comprehensive Audit & Fix)
