# configs/sandbox.yaml
mode: "backtest"
symbol: "BTCUSDT"
latency_steps: 0
sim_config_path: "configs/config_sim.yaml"

# Биржевые спецификации (tickSize/stepSize/minNotional), получаем скриптом script_fetch_exchange_specs.py
exchange_specs_path: "data/exchange_specs.json"

# Гварды симуляции: блокировка сигналов
#   - min_history_bars: холодный старт (минимум баров истории до разрешения сигналов)
#   - gap_cooldown_bars: пауза после обнаружения гэпа
#   - gap_threshold_ms: (опционально) считаем гэпом, если Δt > gap_threshold_ms. Если не задан, используем 21_600_000 мс для 4h (1.5x интервала, changed from 90_000 for 1m).
sim_guards:
  min_history_bars: 180
  gap_cooldown_bars: 10
  gap_threshold_ms: 21600000  # 1.5 * 4h = 6 hours (changed from 90000 = 1.5m for 1m timeframe)

# Частотный кулдаун сигналов (в секундах), как в realtime.yaml → min_signal_gap_s
min_signal_gap_s: 300

# Чёрные окна (UTC) отключены по умолчанию; оставьте секцию пустой, чтобы
# симулятор не включал маску без явного запроса.
no_trade: {}

policy:
  module: "strategies.momentum"
  class: "MomentumStrategy"
  params:
    lookback: 5
    enter_threshold: 0.0  # enter >= exit; falls back to legacy ``threshold`` when set
    exit_threshold: 0.0   # exit hysteresis threshold; uses ``threshold`` as fallback
    order_qty: 0.1  # доля позиции

data:
  path: "data/train.parquet"   # или любой CSV/Parquet с колонками: ts_ms, symbol, ref_price(+фичи)
  ts_col: "ts_ms"
  symbol_col: "symbol"
  price_col: "ref_price"

# Динамический спред/слиппедж без стакана:
#   - вычисляем vol_factor и liquidity из данных
#   - строим синтетические bid/ask по формуле ниже и подаём их в сим
dynamic_spread:
  enabled: true
  base_bps: 3.0                 # базовый спред в bps (0.01% = 1 bps)
  alpha_vol: 0.5                # множитель чувствительности к волатильности
  beta_illiquidity: 1.0         # множитель штрафа за низкую ликвидность
  vol_mode: "hl"                # "hl" = (high-low)/close; "ret" = |log return|
  liq_col: "number_of_trades"   # "number_of_trades" или "volume" (если нет trades)
  liq_ref: 240000.0             # опорный уровень ликвидности за 4 часа (240 минут * 1000 = 240000, changed from 1000.0 for 1m)
  min_bps: 1.0                  # нижняя граница итогового спреда
  max_bps: 25.0                 # верхняя граница итогового спреда

out_reports: "logs/sandbox_reports.csv"
